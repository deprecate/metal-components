define(["exports","metal/src/metal","./EventHandle"],function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0});var a=r(n),u=function(t){function n(){i(this,n);var e=o(this,t.call(this));return e.events_=[],e.maxListeners_=10,e.shouldUseFacade_=!1,e}return s(n,t),n.prototype.addListener=function(t,e,n){this.validateListener_(e),t=this.normalizeEvents_(t);for(var r=0;r<t.length;r++)this.addSingleListener_(t[r],e,n);return new a["default"](this,t,e)},n.prototype.addSingleListener_=function(t,e,n,r){this.emit("newListener",t,e),this.events_[t]||(this.events_[t]=[]),this.events_[t].push({"default":n,fn:e,origin:r});var i=this.events_[t];i.length>this.maxListeners_&&!i.warned&&(i.warned=!0)},n.prototype.disposeInternal=function(){this.events_=[]},n.prototype.emit=function(t){var n,r=e.array.slice(arguments,1),i=(this.events_[t]||[]).concat();this.getShouldUseFacade()&&(n={preventDefault:function(){n.preventedDefault=!0},target:this,type:t},r.push(n));for(var o=[],s=0;s<i.length;s++)i[s]["default"]?o.push(i[s]):i[s].fn.apply(this,r);if(!n||!n.preventedDefault)for(var a=0;a<o.length;a++)o[a].fn.apply(this,r);return"*"!==t&&this.emit.apply(this,["*",t].concat(r)),i.length>0},n.prototype.getShouldUseFacade=function(){return this.shouldUseFacade_},n.prototype.listeners=function(t){return(this.events_[t]||[]).map(function(t){return t.fn})},n.prototype.many=function(t,e,n){t=this.normalizeEvents_(t);for(var r=0;r<t.length;r++)this.many_(t[r],e,n);return new a["default"](this,t,n)},n.prototype.many_=function(t,e,n){function r(){0===--e&&i.removeListener(t,r),n.apply(i,arguments)}var i=this;e<=0||i.addSingleListener_(t,r,!1,n)},n.prototype.matchesListener_=function(t,e){return t.fn===e||t.origin&&t.origin===e},n.prototype.normalizeEvents_=function(t){return e.core.isString(t)?[t]:t},n.prototype.off=function(t,e){this.validateListener_(e),t=this.normalizeEvents_(t);for(var n=0;n<t.length;n++){var r=this.events_[t[n]]||[];this.removeMatchingListenerObjs_(r,e)}return this},n.prototype.on=function(){return this.addListener.apply(this,arguments)},n.prototype.once=function(t,e){return this.many(t,1,e)},n.prototype.removeAllListeners=function(t){if(t)for(var e=this.normalizeEvents_(t),n=0;n<e.length;n++)this.events_[e[n]]=null;else this.events_={};return this},n.prototype.removeMatchingListenerObjs_=function(t,e){for(var n=t.length-1;n>=0;n--)this.matchesListener_(t[n],e)&&t.splice(n,1)},n.prototype.removeListener=function(){return this.off.apply(this,arguments)},n.prototype.setMaxListeners=function(t){return this.maxListeners_=t,this},n.prototype.setShouldUseFacade=function(t){return this.shouldUseFacade_=t,this},n.prototype.validateListener_=function(t){if(!e.core.isFunction(t))throw new TypeError("Listener must be a function")},n}(e.Disposable);t["default"]=u});