this.crystal=this.crystal||{},this.crystalNamed=this.crystalNamed||{},function(e){var t=e.babelHelpers={};t["typeof"]=function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},t.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t.get=function n(e,t,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var s=Object.getPrototypeOf(e);return null===s?void 0:n(s,t,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},t.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},t.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}}("undefined"==typeof global?self:global),function(){var e=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"abstractMethod",value:function(){throw Error("Unimplemented abstract method")}},{key:"collectSuperClassesProperty",value:function(e,t){for(var n=[e[t]];e.__proto__&&!e.__proto__.isPrototypeOf(Function);)e=e.__proto__,n.push(e[t]);return n}},{key:"getFunctionName",value:function(e){if(!e.name){var t=e.toString();e.name=t.substring(9,t.indexOf("("))}return e.name}},{key:"getUid",value:function(t){return t?t[e.UID_PROPERTY]||(t[e.UID_PROPERTY]=e.uniqueIdCounter_++):e.uniqueIdCounter_++}},{key:"identityFunction",value:function(e){return e}},{key:"isBoolean",value:function(e){return"boolean"==typeof e}},{key:"isDef",value:function(e){return void 0!==e}},{key:"isDefAndNotNull",value:function(t){return e.isDef(t)&&!e.isNull(t)}},{key:"isDocument",value:function(e){return e&&"object"===("undefined"==typeof e?"undefined":babelHelpers["typeof"](e))&&9===e.nodeType}},{key:"isElement",value:function(e){return e&&"object"===("undefined"==typeof e?"undefined":babelHelpers["typeof"](e))&&1===e.nodeType}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isNull",value:function(e){return null===e}},{key:"isNumber",value:function(e){return"number"==typeof e}},{key:"isWindow",value:function(e){return null!==e&&e===e.window}},{key:"isObject",value:function(e){var t="undefined"==typeof e?"undefined":babelHelpers["typeof"](e);return"object"===t&&null!==e||"function"===t}},{key:"isString",value:function(e){return"string"==typeof e}},{key:"mergeSuperClassesProperty",value:function(t,n,r){var i=n+"_MERGED";if(t.hasOwnProperty(i))return!1;var s=e.collectSuperClassesProperty(t,n);return r&&(s=r(s)),t[i]=s,!0}},{key:"nullFunction",value:function(){}}]),e}();e.UID_PROPERTY="core_"+(1e9*Math.random()>>>0),e.uniqueIdCounter_=1,this.crystal.core=e}.call(this),function(){var e=this.crystal.core,t=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"mixin",value:function(e){for(var t,n,r=1;r<arguments.length;r++){n=arguments[r];for(t in n)e[t]=n[t]}return e}},{key:"getObjectByName",value:function(t,n){for(var r,i=t.split("."),s=n||window;r=i.shift();){if(!e.isDefAndNotNull(s[r]))return null;s=s[r]}return s}}]),t}();this.crystal.object=t}.call(this),function(){var e=function(){function e(){babelHelpers.classCallCheck(this,e),this.disposed_=!1}return babelHelpers.createClass(e,[{key:"dispose",value:function(){this.disposed_||(this.disposeInternal(),this.disposed_=!0)}},{key:"disposeInternal",value:function(){}},{key:"isDisposed",value:function(){return this.disposed_}}]),e}();this.crystal.Disposable=e}.call(this),function(){var e=this.crystal.Disposable,t=function(e){function t(e,n,r){babelHelpers.classCallCheck(this,t);var i=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return i.emitter_=e,i.event_=n,i.listener_=r,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"disposeInternal",value:function(){this.removeListener(),this.emitter_=null,this.listener_=null}},{key:"removeListener",value:function(){this.emitter_.isDisposed()||this.emitter_.removeListener(this.event_,this.listener_)}}]),t}(e);this.crystal.EventHandle=t}.call(this),function(){var e=this.crystal.EventHandle,t=function(e){function t(e,n,r,i){babelHelpers.classCallCheck(this,t);var s=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n,r));return s.capture_=i,s}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"removeListener",value:function(){this.emitter_.removeEventListener(this.event_,this.listener_,this.capture_)}}]),t}(e);this.crystal.DomEventHandle=t}.call(this),function(){var e=this.crystal.core,t=this.crystal.object,n=this.crystal.DomEventHandle,r=function(){function r(){babelHelpers.classCallCheck(this,r)}return babelHelpers.createClass(r,null,[{key:"addClasses",value:function(t,n){e.isObject(t)&&e.isString(n)&&("classList"in t?r.addClassesWithNative_(t,n):r.addClassesWithoutNative_(t,n))}},{key:"addClassesWithNative_",value:function(e,t){t.split(" ").forEach(function(t){e.classList.add(t)})}},{key:"addClassesWithoutNative_",value:function(e,t){var n=" "+e.className+" ",r="";t=t.split(" ");for(var i=0;i<t.length;i++){var s=t[i];-1===n.indexOf(" "+s+" ")&&(r+=" "+s)}r&&(e.className=e.className+r)}},{key:"append",value:function(t,n){if(e.isString(n)&&(n=r.buildFragment(n)),n instanceof NodeList)for(var i=Array.prototype.slice.call(n),s=0;s<i.length;s++)t.appendChild(i[s]);else t.appendChild(n);return n}},{key:"buildFragment",value:function(e){var t=document.createElement("div");t.innerHTML="<br>"+e,t.removeChild(t.firstChild);for(var n=document.createDocumentFragment();t.firstChild;)n.appendChild(t.firstChild);return n}},{key:"contains",value:function(t,n){return e.isDocument(t)?t.documentElement.contains(n):t.contains(n)}},{key:"delegate",value:function(e,t,n,i){var s=r.customEvents[t];return s&&s.delegate&&(t=s.originalEvent,i=s.handler.bind(s,i)),r.on(e,t,r.handleDelegateEvent_.bind(null,n,i))}},{key:"enterDocument",value:function(e){r.append(document.body,e)}},{key:"exitDocument",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"handleDelegateEvent_",value:function(t,n,i){r.normalizeDelegateEvent_(i);for(var s=i.target,a=!0;s&&!i.stopped&&(e.isString(t)&&r.match(s,t)&&(i.delegateTarget=s,a&=n(i)),s!==i.currentTarget);)s=s.parentNode;return i.delegateTarget=null,a}},{key:"hasClass",value:function(e,t){return"classList"in e?r.hasClassWithNative_(e,t):r.hasClassWithoutNative_(e,t)}},{key:"hasClassWithNative_",value:function(e,t){return e.classList.contains(t)}},{key:"hasClassWithoutNative_",value:function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>=0}},{key:"isEmpty",value:function(e){return 0===e.childNodes.length}},{key:"match",value:function(e,t){if(!e||1!==e.nodeType)return!1;var n=Element.prototype,i=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;return i?i.call(e,t):r.matchFallback_(e,t)}},{key:"matchFallback_",value:function(e,t){for(var n=document.querySelectorAll(t,e.parentNode),r=0;r<n.length;++r)if(n[r]===e)return!0;return!1}},{key:"normalizeDelegateEvent_",value:function(e){e.stopPropagation=r.stopPropagation_,e.stopImmediatePropagation=r.stopImmediatePropagation_}},{key:"on",value:function(t,i,s,a){if(e.isString(t))return r.delegate(document,i,t,s);var l=r.customEvents[i];return l&&l.event&&(i=l.originalEvent,s=l.handler.bind(l,s)),t.addEventListener(i,s,a),new n(t,i,s,a)}},{key:"once",value:function(e,t,n){var r=this.on(e,t,function(){return r.removeListener(),n.apply(this,arguments)});return r}},{key:"registerCustomEvent",value:function(e,t){r.customEvents[e]=t}},{key:"removeChildren",value:function(e){for(var t;t=e.firstChild;)e.removeChild(t)}},{key:"removeClasses",value:function(t,n){e.isObject(t)&&e.isString(n)&&("classList"in t?r.removeClassesWithNative_(t,n):r.removeClassesWithoutNative_(t,n))}},{key:"removeClassesWithNative_",value:function(e,t){t.split(" ").forEach(function(t){e.classList.remove(t)})}},{key:"removeClassesWithoutNative_",value:function(e,t){var n=" "+e.className+" ";t=t.split(" ");for(var r=0;r<t.length;r++)n=n.replace(" "+t[r]+" "," ");e.className=n.trim()}},{key:"replace",value:function(e,t){e&&t&&e!==t&&e.parentNode&&(e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e))}},{key:"stopImmediatePropagation_",value:function(){this.stopped=!0,Event.prototype.stopImmediatePropagation.call(this)}},{key:"stopPropagation_",value:function(){this.stopped=!0,Event.prototype.stopPropagation.call(this)}},{key:"supportsEvent",value:function(t,n){return r.customEvents[n]?!0:(e.isString(t)&&(i[t]||(i[t]=document.createElement(t)),t=i[t]),"on"+n in t)}},{key:"toElement",value:function(t){return e.isElement(t)||e.isDocument(t)?t:e.isString(t)?"#"===t[0]&&-1===t.indexOf(" ")?document.getElementById(t.substr(1)):document.querySelector(t):null}},{key:"toggleClasses",value:function(t,n){e.isObject(t)&&e.isString(n)&&("classList"in t?r.toggleClassesWithNative_(t,n):r.toggleClassesWithoutNative_(t,n))}},{key:"toggleClassesWithNative_",value:function(e,t){t.split(" ").forEach(function(t){e.classList.toggle(t)})}},{key:"toggleClassesWithoutNative_",value:function(e,t){var n=" "+e.className+" ";t=t.split(" ");for(var r=0;r<t.length;r++){var i=" "+t[r]+" ",s=n.indexOf(i);n=-1===s?n+t[r]+" ":n.substring(0,s)+" "+n.substring(s+i.length)}e.className=n.trim()}},{key:"triggerEvent",value:function(e,n,r){var i=document.createEvent("HTMLEvents");i.initEvent(n,!0,!0),t.mixin(i,r),e.dispatchEvent(i)}}]),r}(),i={};r.customEvents={},this.crystal.dom=r}.call(this),function(){var e=this.crystal.Disposable,t=function(e){function t(){babelHelpers.classCallCheck(this,t);var e=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.eventHandles_=[],e}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"add",value:function(){for(var e=0;e<arguments.length;e++)this.eventHandles_.push(arguments[e])}},{key:"disposeInternal",value:function(){this.eventHandles_=null}},{key:"removeAllListeners",value:function(){for(var e=0;e<this.eventHandles_.length;e++)this.eventHandles_[e].removeListener();this.eventHandles_=[]}}]),t}(e);this.crystal.EventHandler=t}.call(this),function(){var e=this.crystal.core,t=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"equal",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return e.length===t.length}},{key:"firstDefinedValue",value:function(e){for(var t=0;t<e.length;t++)if(void 0!==e[t])return e[t]}},{key:"flatten",value:function(e,n){for(var r=n||[],i=0;i<e.length;i++)Array.isArray(e[i])?t.flatten(e[i],r):r.push(e[i]);return r}},{key:"remove",value:function(e,n){var r,i=e.indexOf(n);return(r=i>=0)&&t.removeAt(e,i),r}},{key:"removeAt",value:function(e,t){return 1===Array.prototype.splice.call(e,t,1).length}},{key:"slice",value:function(t,n,r){for(var i=[],s=e.isDef(r)?r:t.length,a=n;s>a;a++)i.push(t[a]);return i}}]),t}();this.crystal.array=t}.call(this),function(){var e=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"collapseBreakingSpaces",value:function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")}},{key:"hashCode",value:function(e){for(var t=0,n=0,r=e.length;r>n;n++)t=31*t+e.charCodeAt(n),t%=4294967296;return t}},{key:"replaceInterval",value:function(e,t,n,r){return e.substring(0,t)+r+e.substring(n)}}]),e}();this.crystal.string=e}.call(this),function(){var e=this.crystal.dom,t=this.crystal.string,n=function(){function n(){babelHelpers.classCallCheck(this,n)}return babelHelpers.createClass(n,null,[{key:"checkAnimationEventName",value:function(){return void 0===n.animationEventName_&&(n.animationEventName_={animation:n.checkAnimationEventName_("animation"),transition:n.checkAnimationEventName_("transition")}),n.animationEventName_}},{key:"checkAnimationEventName_",value:function(e){for(var r=["Webkit","MS","O",""],i=t.replaceInterval(e,0,1,e.substring(0,1).toUpperCase()),s=[i+"End",i+"End",i+"End",e+"end"],a=0;a<r.length;a++)if(void 0!==n.animationElement_.style[r[a]+i])return r[a].toLowerCase()+s[a];return e+"end"}},{key:"checkAttrOrderChange",value:function(){if(void 0===n.attrOrderChange_){var t='<div data-component="" data-ref=""></div>',r=document.createElement("div");e.append(r,t),n.attrOrderChange_=t!==r.innerHTML}return n.attrOrderChange_}}]),n}();n.animationElement_=document.createElement("div"),n.animationEventName_=void 0,n.attrOrderChange_=void 0,this.crystal.features=n}.call(this),function(){var e=this.crystal.dom,t=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"run",value:function(e){var t=document.createElement("script");t.text=e,document.head.appendChild(t).parentNode.removeChild(t)}},{key:"runFile",value:function(t){var n=document.createElement("script");n.src=t,e.on(n,"load",function(){n.parentNode.removeChild(n)}),e.on(n,"error",function(){n.parentNode.removeChild(n)}),document.head.appendChild(n)}},{key:"runScript",value:function(e){e.parentNode&&e.parentNode.removeChild(e),e.src?t.runFile(e.src):t.run(e.text)}}]),t}();this.crystal.globalEval=t}.call(this),function(){var e=this.crystal.core,t=this.crystal.string,n=function(){function n(){babelHelpers.classCallCheck(this,n)}return babelHelpers.createClass(n,null,[{key:"compress",value:function(e){var t={};return e=n.preserveBlocks_(e,t),e=n.simplifyDoctype_(e),e=n.removeComments_(e),e=n.removeIntertagSpaces_(e),e=n.collapseBreakingSpaces_(e),e=n.removeSpacesInsideTags_(e),e=n.removeSurroundingSpaces_(e),e=n.returnBlocks_(e,t),e.trim()}},{key:"collapseBreakingSpaces_",value:function(e){return t.collapseBreakingSpaces(e)}},{key:"lookupPossibleTagBoundary_",value:function(e,t){var n=e.indexOf(t);return n>-1&&(n+=e.substring(n).indexOf(">")+1),n}},{key:"preserveBlocks_",value:function(e,t){return e=n.preserveOuterHtml_(e,"<!--[if","<![endif]-->",t),e=n.preserveInnerHtml_(e,"<code","</code",t),e=n.preserveInnerHtml_(e,"<pre","</pre",t),e=n.preserveInnerHtml_(e,"<script","</script",t),e=n.preserveInnerHtml_(e,"<style","</style",t),e=n.preserveInnerHtml_(e,"<textarea","</textarea",t)}},{key:"preserveInnerHtml_",value:function(e,t,r,i){for(var s=n.lookupPossibleTagBoundary_(e,t);s>-1;){var a=e.indexOf(r);e=n.preserveInterval_(e,s,a,i),e=e.replace(t,"%%%~1~%%%"),e=e.replace(r,"%%%~2~%%%"),s=n.lookupPossibleTagBoundary_(e,t)}return e=e.replace(/%%%~1~%%%/g,t),e=e.replace(/%%%~2~%%%/g,r)}},{key:"preserveInterval_",value:function(n,r,i,s){var a="%%%~BLOCK~"+e.getUid()+"~%%%";return s[a]=n.substring(r,i),t.replaceInterval(n,r,i,a)}},{key:"preserveOuterHtml_",value:function(e,t,r,i){for(var s=e.indexOf(t);s>-1;){var a=e.indexOf(r)+r.length;e=n.preserveInterval_(e,s,a,i),s=e.indexOf(t)}return e}},{key:"removeComments_",value:function(e){var t={};return e=n.preserveOuterHtml_(e,"<![CDATA[","]]>",t),e=n.preserveOuterHtml_(e,"<!--","-->",t),e=n.replacePreservedBlocks_(e,t,"")}},{key:"removeIntertagSpaces_",value:function(e){return e=e.replace(n.Patterns.INTERTAG_CUSTOM_CUSTOM,"~%%%%%%~"),e=e.replace(n.Patterns.INTERTAG_CUSTOM_TAG,"~%%%<"),e=e.replace(n.Patterns.INTERTAG_TAG,"><"),e=e.replace(n.Patterns.INTERTAG_TAG_CUSTOM,">%%%~")}},{key:"removeSpacesInsideTags_",value:function(e){return e=e.replace(n.Patterns.TAG_END_SPACES,"$1$2"),e=e.replace(n.Patterns.TAG_QUOTE_SPACES,"=$1$2$3")}},{key:"removeSurroundingSpaces_",value:function(e){return e.replace(n.Patterns.SURROUNDING_SPACES,"$1")}},{key:"replacePreservedBlocks_",value:function(e,t,n){for(var r in t)e=e.replace(r,n);return e}},{key:"simplifyDoctype_",value:function(e){var t={};return e=n.preserveOuterHtml_(e,"<!DOCTYPE",">",t),e=n.replacePreservedBlocks_(e,t,"<!DOCTYPE html>")}},{key:"returnBlocks_",value:function(e,t){for(var n in t)e=e.replace(n,t[n]);return e}}]),n}();n.Patterns={INTERTAG_CUSTOM_CUSTOM:/~%%%\s+%%%~/g,INTERTAG_TAG_CUSTOM:/>\s+%%%~/g,INTERTAG_CUSTOM_TAG:/~%%%\s+</g,INTERTAG_TAG:/>\s+</g,SURROUNDING_SPACES:/\s*(<[^>]+>)\s*/g,TAG_END_SPACES:/(<(?:[^>]+?))(?:\s+?)(\/?>)/g,TAG_QUOTE_SPACES:/\s*=\s*(["']?)\s*(.*?)\s*(\1)/g},this.crystal.html=n}.call(this),function(){var e=this.crystal.core,t=this.crystal.array,n=this.crystal.Disposable,r=this.crystal.EventHandle,i=function(n){function i(){babelHelpers.classCallCheck(this,i);var e=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this));return e.events_=[],e.maxListeners_=10,e.shouldUseFacade_=!1,e}return babelHelpers.inherits(i,n),babelHelpers.createClass(i,[{key:"addListener",value:function(e,t,n){this.validateListener_(t),e=this.normalizeEvents_(e);for(var i=0;i<e.length;i++)this.addSingleListener_(e[i],t,n);return new r(this,e,t)}},{key:"addSingleListener_",value:function(e,t,n,r){this.emit("newListener",e,t),this.events_[e]||(this.events_[e]=[]),this.events_[e].push({"default":n,fn:t,origin:r});var i=this.events_[e];i.length>this.maxListeners_&&!i.warned&&(i.warned=!0)}},{key:"disposeInternal",value:function(){this.events_=[]}},{key:"emit",value:function(e){var n,r=t.slice(arguments,1),i=(this.events_[e]||[]).concat();this.getShouldUseFacade()&&(n={preventDefault:function(){n.preventedDefault=!0},target:this,type:e},r.push(n));for(var s=[],a=0;a<i.length;a++)i[a]["default"]?s.push(i[a]):i[a].fn.apply(this,r);if(!n||!n.preventedDefault)for(var l=0;l<s.length;l++)s[l].fn.apply(this,r);return"*"!==e&&this.emit.apply(this,["*",e].concat(r)),i.length>0}},{key:"getShouldUseFacade",value:function(){return this.shouldUseFacade_}},{key:"listeners",value:function(e){return(this.events_[e]||[]).map(function(e){return e.fn})}},{key:"many",value:function(e,t,n){e=this.normalizeEvents_(e);for(var i=0;i<e.length;i++)this.many_(e[i],t,n);return new r(this,e,n)}},{key:"many_",value:function(e,t,n){function r(){0===--t&&i.removeListener(e,r),n.apply(i,arguments)}var i=this;0>=t||i.addSingleListener_(e,r,!1,n)}},{key:"matchesListener_",value:function(e,t){return e.fn===t||e.origin&&e.origin===t}},{key:"normalizeEvents_",value:function(t){return e.isString(t)?[t]:t}},{key:"off",value:function(e,t){this.validateListener_(t),e=this.normalizeEvents_(e);for(var n=0;n<e.length;n++){var r=this.events_[e[n]]||[];this.removeMatchingListenerObjs_(r,t)}return this}},{key:"on",value:function(){return this.addListener.apply(this,arguments)}},{key:"once",value:function(e,t){return this.many(e,1,t)}},{key:"removeAllListeners",value:function(e){if(e)for(var t=this.normalizeEvents_(e),n=0;n<t.length;n++)this.events_[t[n]]=null;else this.events_={};return this}},{key:"removeMatchingListenerObjs_",value:function(e,t){for(var n=e.length-1;n>=0;n--)this.matchesListener_(e[n],t)&&e.splice(n,1)}},{key:"removeListener",value:function(){return this.off.apply(this,arguments)}},{key:"setMaxListeners",value:function(e){return this.maxListeners_=e,this}},{key:"setShouldUseFacade",value:function(e){return this.shouldUseFacade_=e,this}},{key:"validateListener_",value:function(t){if(!e.isFunction(t))throw new TypeError("Listener must be a function")}}]),i}(n);this.crystal.EventEmitter=i}.call(this),function(){var e=this.crystal.core,t={};t.throwException=function(e){t.nextTick(function(){throw e})},t.run=function(e,n){t.run.workQueueScheduled_||(t.nextTick(t.run.processWorkQueue),t.run.workQueueScheduled_=!0),t.run.workQueue_.push(new t.run.WorkItem_(e,n))},t.run.workQueueScheduled_=!1,t.run.workQueue_=[],t.run.processWorkQueue=function(){for(;t.run.workQueue_.length;){var e=t.run.workQueue_;t.run.workQueue_=[];for(var n=0;n<e.length;n++){var r=e[n];try{r.fn.call(r.scope)}catch(i){t.throwException(i)}}}t.run.workQueueScheduled_=!1},t.run.WorkItem_=function(e,t){this.fn=e,this.scope=t},t.nextTick=function(n,r){var i=n;return r&&(i=n.bind(r)),i=t.nextTick.wrapCallback_(i),e.isFunction(window.setImmediate)?void window.setImmediate(i):(t.nextTick.setImmediate_||(t.nextTick.setImmediate_=t.nextTick.getSetImmediateEmulator_()),void t.nextTick.setImmediate_(i))},t.nextTick.setImmediate_=null,t.nextTick.getSetImmediateEmulator_=function(){var e=window.MessageChannel;if("undefined"==typeof e&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&(e=function(){var e=document.createElement("iframe");e.style.display="none",e.src="",document.documentElement.appendChild(e);var t=e.contentWindow,n=t.document;n.open(),n.write(""),n.close();var r="callImmediate"+Math.random(),i=t.location.protocol+"//"+t.location.host,s=function(e){(e.origin===i||e.data===r)&&this.port1.onmessage()}.bind(this);t.addEventListener("message",s,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(r,i)}}}),"undefined"!=typeof e){var t=new e,n={},r=n;return t.port1.onmessage=function(){n=n.next;var e=n.cb;n.cb=null,e()},function(e){r.next={cb:e},r=r.next,t.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("script")?function(e){var t=document.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,t.parentNode.removeChild(t),t=null,e(),e=null},document.documentElement.appendChild(t)}:function(e){setTimeout(e,0)}},t.nextTick.wrapCallback_=function(e){return e},this.crystal.async=t}.call(this),function(){var e=this.crystal.array,t=this.crystal.core,n=this.crystal.object,r=this.crystal.EventEmitter,i=this.crystal.async,s=function(r){function s(e){babelHelpers.classCallCheck(this,s);var t=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(s).call(this));return t.scheduledBatchData_=null,t.attrsInfo_={},t.setShouldUseFacade(!0),t.mergeInvalidAttrs_(),t.addAttrsFromStaticHint_(e),t}return babelHelpers.inherits(s,r),babelHelpers.createClass(s,[{key:"addAttr",value:function(e,t,n){this.buildAttrInfo_(e,t,n),Object.defineProperty(this,e,this.buildAttrPropertyDef_(e))}},{key:"addAttrs",value:function(e,t,n){t=t||{};for(var r=Object.keys(e),i={},s=0;s<r.length;s++){var a=r[s];this.buildAttrInfo_(a,e[a],t[a]),i[a]=this.buildAttrPropertyDef_(a)}n!==!1&&Object.defineProperties(n||this,i)}},{key:"addAttrsFromStaticHint_",value:function(e){var t=this.constructor,n=!1;s.mergeAttrsStatic(t)&&(n=t.prototype),this.addAttrs(t.ATTRS_MERGED,e,n)}},{key:"assertValidAttrName_",value:function(e){if(this.constructor.INVALID_ATTRS_MERGED[e])throw new Error("It's not allowed to create an attribute with the name \""+e+'".')}},{key:"buildAttrInfo_",value:function(e,t,n){this.assertValidAttrName_(e),this.attrsInfo_[e]={config:t||{},initialValue:n,state:s.States.UNINITIALIZED}}},{key:"buildAttrPropertyDef_",value:function(e){return{configurable:!0,enumerable:!0,get:function(){return this.getAttrValue_(e)},set:function(t){this.setAttrValue_(e,t)}}}},{key:"callFunction_",value:function(e,n){return t.isString(e)?this[e].apply(this,n):t.isFunction(e)?e.apply(this,n):void 0}},{key:"callSetter_",value:function(e,t){var n=this.attrsInfo_[e],r=n.config;return r.setter&&(t=this.callFunction_(r.setter,[t])),t}},{key:"callValidator_",value:function(e,t){var n=this.attrsInfo_[e],r=n.config;return r.validator?this.callFunction_(r.validator,[t]):!0}},{key:"canSetAttribute",value:function(e){var t=this.attrsInfo_[e];return!t.config.writeOnce||!t.written}},{key:"disposeInternal",value:function(){babelHelpers.get(Object.getPrototypeOf(s.prototype),"disposeInternal",this).call(this),this.attrsInfo_=null,this.scheduledBatchData_=null}},{key:"emitBatchEvent_",value:function(){if(!this.isDisposed()){var e=this.scheduledBatchData_;this.scheduledBatchData_=null,this.emit("attrsChanged",e)}}},{key:"get",value:function(e){return this[e]}},{key:"getAttrConfig",value:function(e){return(this.attrsInfo_[e]||{}).config}},{key:"getAttrs",value:function(e){for(var t={},n=e||this.getAttrNames(),r=0;r<n.length;r++)t[n[r]]=this[n[r]];return t}},{key:"getAttrNames",value:function(){return Object.keys(this.attrsInfo_)}},{key:"getAttrValue_",value:function(e){return this.initAttr_(e),this.attrsInfo_[e].value}},{key:"informChange_",value:function(e,t){if(this.shouldInformChange_(e,t)){var n={attrName:e,newVal:this[e],prevVal:t};this.emit(e+"Changed",n),this.scheduleBatchEvent_(n)}}},{key:"initAttr_",value:function(e){var t=this.attrsInfo_[e];t.state===s.States.UNINITIALIZED&&(t.state=s.States.INITIALIZING,this.setInitialValue_(e),t.written||(t.state=s.States.INITIALIZING_DEFAULT,this.setDefaultValue_(e)),t.state=s.States.INITIALIZED)}},{key:"mergeInvalidAttrs_",value:function(){t.mergeSuperClassesProperty(this.constructor,"INVALID_ATTRS",function(t){return e.flatten(t).reduce(function(e,t){return t&&(e[t]=!0),e},{})})}},{key:"removeAttr",value:function(e){this.attrsInfo_[e]=null,delete this[e]}},{key:"scheduleBatchEvent_",value:function(e){this.scheduledBatchData_||(i.nextTick(this.emitBatchEvent_,this),this.scheduledBatchData_={changes:{}});var t=e.attrName,n=this.scheduledBatchData_.changes;n[t]?n[t].newVal=e.newVal:n[t]=e}},{key:"set",value:function(e,t){this[e]=t}},{key:"setAttrs",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)this[t[n]]=e[t[n]]}},{key:"setAttrValue_",value:function(e,t){if(this.canSetAttribute(e)&&this.validateAttrValue_(e,t)){var n=this.attrsInfo_[e];void 0===n.initialValue&&n.state===s.States.UNINITIALIZED&&(n.state=s.States.INITIALIZED);var r=this[e];n.value=this.callSetter_(e,t),n.written=!0,this.informChange_(e,r)}}},{key:"setDefaultValue_",value:function(e){var t=this.attrsInfo_[e].config;void 0!==t.value?this[e]=t.value:this[e]=this.callFunction_(t.valueFn)}},{key:"setInitialValue_",value:function(e){var t=this.attrsInfo_[e];void 0!==t.initialValue&&(this[e]=t.initialValue,t.initialValue=void 0)}},{key:"shouldInformChange_",value:function(e,n){var r=this.attrsInfo_[e];return r.state===s.States.INITIALIZED&&(t.isObject(n)||n!==this[e])}},{key:"validateAttrValue_",value:function(e,t){var n=this.attrsInfo_[e];return n.state===s.States.INITIALIZING_DEFAULT||this.callValidator_(e,t)}}],[{key:"mergeAttrs_",value:function(e){return n.mixin.apply(null,[{}].concat(e.reverse()))}},{key:"mergeAttrsStatic",value:function(e){return t.mergeSuperClassesProperty(e,"ATTRS",s.mergeAttrs_)}}]),s}(r);s.INVALID_ATTRS=["attrs"],s.States={UNINITIALIZED:0,INITIALIZING:1,INITIALIZING_DEFAULT:2,INITIALIZED:3},this.crystal.Attribute=s}.call(this),function(){var e=this.crystal.core,t=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"getConstructor",value:function(e){var n=t.components_[e];return n}},{key:"register",value:function(n,r){var i=r;i||(i=n.hasOwnProperty("NAME")?n.NAME:e.getFunctionName(n)),n.NAME=i,t.components_[i]=n}}]),t}();t.components_={},this.crystal.ComponentRegistry=t}.call(this),function(){var e=this.crystal.ComponentRegistry,t=this.crystal.Disposable,n=function(t){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,t),babelHelpers.createClass(n,[{key:"addComponent",value:function(e){n.components[e.id]=e}},{key:"createComponent",value:function(t,r,i){var s=n.components[r];if(!s){var a=e.getConstructor(t),l=i||{};l.id=r,l.element="#"+r,s=new a(l)}return s}},{key:"removeComponent",value:function(e){delete n.components[e.id]}},{key:"updateComponent",value:function(e,t){var r=n.components[e];return r&&t&&r.setAttrs(t),r}}]),n}(t);n.components={},this.crystal.ComponentCollector=n}.call(this),function(){var e=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"getSurfaceContent",value:function(){}}]),e}();this.crystal.ComponentRenderer=e}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.Disposable,r=function(n){function r(e,t,n,i){babelHelpers.classCallCheck(this,r);var s=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this));return s.blacklist_=n||{},s.originEmitter_=e,s.proxiedEvents_={},s.targetEmitter_=t,s.whitelist_=i,s.startProxy_(),s}return babelHelpers.inherits(r,n),babelHelpers.createClass(r,[{key:"disposeInternal",value:function(){var e=this.originEmitter_.removeEventListener?"removeEventListener":"removeListener";for(var t in this.proxiedEvents_)this.originEmitter_[e](t,this.proxiedEvents_[t]);this.proxiedEvents_=null,this.originEmitter_=null,this.targetEmitter_=null}},{key:"proxyEvent_",value:function(n){if(this.shouldProxyEvent_(n)){var r=this;this.proxiedEvents_[n]=function(){var e=[n].concat(Array.prototype.slice.call(arguments,0));r.targetEmitter_.emit.apply(r.targetEmitter_,e)},e.isElement(this.originEmitter_)||e.isDocument(this.originEmitter_)?t.on(this.originEmitter_,n,this.proxiedEvents_[n]):this.originEmitter_.on(n,this.proxiedEvents_[n])}}},{key:"shouldProxyEvent_",value:function(e){return this.whitelist_&&!this.whitelist_[e]?!1:this.blacklist_[e]?!1:!this.proxiedEvents_[e]&&(!(this.originEmitter_.removeEventListener||this.originEmitter_.addEventListener)||t.supportsEvent(this.originEmitter_,e))}},{key:"startProxy_",value:function(){this.targetEmitter_.on("newListener",this.proxyEvent_.bind(this))}}]),r}(n);this.crystal.EventEmitterProxy=r}.call(this),function(){var e=this.crystal.core,t=this.crystal.ComponentCollector,n=this.crystal.Disposable,r=this.crystal.EventHandler,i=function(n){function i(e){babelHelpers.classCallCheck(this,i);var t=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this));if(!e)throw new Error("The component instance is mandatory");return t.component_=e,t.eventHandles_={},t.groupHasListener_={},t}return babelHelpers.inherits(i,n),babelHelpers.createClass(i,[{key:"attachListener_",value:function(e,t,n){var i="[data-on"+e+'="'+t+'"]';if(this.groupHasListener_[n][i]=!0,!this.eventHandles_[i]){this.eventHandles_[i]=new r;for(var s=t.split(","),a=0;a<s.length;a++){var l=this.getListenerFn(s[a]);l&&this.eventHandles_[i].add(this.component_.delegate(e,i,this.onEvent_.bind(this,l)))}}}},{key:"attachListeners",value:function(e,t){this.groupHasListener_[t]={},this.attachListenersFromHtml_(e,t)}},{key:"attachListenersFromHtml_",value:function(e,t){if(-1!==e.indexOf("data-on"))for(var n=/data-on([a-z]+)=['"]([^'"]+)['"]/g,r=n.exec(e);r;)this.attachListener_(r[1],r[2],t),r=n.exec(e)}},{key:"detachAllListeners",value:function(){for(var e in this.eventHandles_)this.eventHandles_[e]&&this.eventHandles_[e].removeAllListeners();this.eventHandles_={},this.listenerCounts_={}}},{key:"detachUnusedListeners",value:function(){for(var e in this.eventHandles_)if(this.eventHandles_[e]){var t=!0;for(var n in this.groupHasListener_)if(this.groupHasListener_[n][e]){t=!1;break}t&&(this.eventHandles_[e].removeAllListeners(),this.eventHandles_[e]=null)}}},{key:"disposeInternal",value:function(){this.detachAllListeners(),this.component_=null}},{key:"getListenerFn",value:function(n){var r,i=n.split(":");return 2===i.length&&(n=i[1],r=t.components[i[0]]),r=r||this.component_,e.isFunction(r[n])?r[n].bind(r):void 0}},{key:"hasAttachedForGroup",value:function(e){return!!this.groupHasListener_.hasOwnProperty(e)}},{key:"onEvent_",value:function(e,t){var n=t.handledByComponent;return!n||n===this.component_||t.delegateTarget.contains(n.element)?(t.handledByComponent=this.component_,e(t)):void 0}}]),i}(n);this.crystal.EventsCollector=i}.call(this),function(){var e=this.crystal.object,t=this.crystal.Disposable,n=function(t){function n(){babelHelpers.classCallCheck(this,n);var e=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this));
return e.surfaces_={},e}return babelHelpers.inherits(n,t),babelHelpers.createClass(n,[{key:"addSurface",value:function(e,t){this.surfaces_[e]?this.updateSurface(e,t):(this.surfaces_[e]=t||{},this.surfaces_[e].surfaceElementId=e)}},{key:"disposeInternal",value:function(){this.surfaces_=null}},{key:"getSurface",value:function(e){return this.surfaces_[e]?this.surfaces_[e]:null}},{key:"removeAllSurfaces",value:function(){this.surfaces_=[]}},{key:"removeSurface",value:function(e){this.surfaces_[e]=null}},{key:"updateSurface",value:function(t,n){e.mixin(this.surfaces_[t],n)}}]),n}(t);this.crystal.SurfaceCollector=n}.call(this),function(){var e=this.crystal.array,t=this.crystal.core,n=this.crystal.dom,r=this.crystal.features,i=this.crystal.globalEval,s=this.crystal.html,a=this.crystal.object,l=this.crystal.string,o=this.crystal.Attribute,c=this.crystal.ComponentCollector,u=this.crystal.ComponentRenderer,h=this.crystal.EventEmitterProxy,d=this.crystal.EventHandler,v=this.crystal.EventsCollector,f=this.crystal.SurfaceCollector,p=function(o){function u(n){babelHelpers.classCallCheck(this,u);var r=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(u).call(this,n));return r.collectedSurfaces_=[],r.components={},r.decorating_=!1,r.delegateEventHandler_=null,r.elementEventProxy_=null,r.eventsAttrHandler_=new d,r.eventsCollector_=new v(r),r.generatedIdCount_={},r.inDocument=!1,r.initialConfig_=n||{},r.removedSurfaces_=[],r.surfaceIds_={},r.wasRendered=!1,r.DEFAULT_ELEMENT_PARENT=document.body,t.mergeSuperClassesProperty(r.constructor,"ELEMENT_CLASSES",r.mergeElementClasses_),t.mergeSuperClassesProperty(r.constructor,"ELEMENT_TAG_NAME",e.firstDefinedValue),t.mergeSuperClassesProperty(r.constructor,"RENDERER",e.firstDefinedValue),t.mergeSuperClassesProperty(r.constructor,"SURFACE_TAG_NAME",e.firstDefinedValue),r.addSurfacesFromStaticHint_(),r.delegateEventHandler_=new d,r.created_(),r}return babelHelpers.inherits(u,o),babelHelpers.createClass(u,[{key:"addListenersFromObj_",value:function(e){for(var t=Object.keys(e||{}),n=0;n<t.length;n++){var r=this.extractListenerInfo_(e[t[n]]);if(r.fn){var i;i=r.selector?this.delegate(t[n],r.selector,r.fn):this.on(t[n],r.fn),this.eventsAttrHandler_.add(i)}}}},{key:"addMissingAttr_",value:function(e,t){this.getAttrConfig(e)||this.addAttr(e,{},t)}},{key:"addSingleListener_",value:function(e,t,r){!this.elementEventProxy_&&n.supportsEvent(this.constructor.ELEMENT_TAG_NAME_MERGED,e)&&(this.elementEventProxy_=new h(this.element,this)),babelHelpers.get(Object.getPrototypeOf(u.prototype),"addSingleListener_",this).call(this,e,t,r)}},{key:"addElementSurface_",value:function(){this.surfaceIds_[this.id]||this.addSurface(this.id,{componentName:this.getName()})}},{key:"addSurface",value:function(e,t){var n=t||{},r=this.getSurfaceElementId(e,n);return this.surfaceIds_[r]?u.surfacesCollector.updateSurface(r,n):(this.surfaceIds_[r]=!0,n.cacheState=n.cacheState||u.Cache.NOT_INITIALIZED,u.surfacesCollector.addSurface(r,n),n.componentName&&e!==this.id&&this.createSubComponent_(n.componentName,r)),this.cacheSurfaceRenderAttrs_(r,n.renderAttrs),this}},{key:"addSurfaces",value:function(e){for(var t in e)this.addSurface(t,e[t]);return this}},{key:"addSurfacesFromStaticHint_",value:function(){t.mergeSuperClassesProperty(this.constructor,"SURFACES",this.mergeObjects_),this.surfacesRenderAttrs_={};var e=this.constructor.SURFACES_MERGED;for(var n in e)this.addSurface(n,a.mixin({},e[n]))}},{key:"addToRemovedSurfaces_",value:function(e){for(var t=0;t<e.length;t++){var n=this.getSurface(e[t]);this.removedSurfaces_.push(n),n.parent=null}}},{key:"attach",value:function(e,t){return this.inDocument||(this.renderElement_(e,t),this.inDocument=!0,this.wasRendered||this.updatePlaceholderSurfaces_(),this.attached()),this}},{key:"attached",value:function(){}},{key:"buildFragment_",value:function(e){var t=n.buildFragment(e);if(-1===e.indexOf("<script"))return t;for(var r=t.querySelectorAll("script"),s=0;s<r.length;s++){var a=r.item(s);a.type&&"text/javascript"!==a.type||i.runScript(a)}return t}},{key:"buildPlaceholder",value:function(e,t){return e&&t&&(t.surfaceElementId=e,this.addSurface(e,t)),"%%%%~s"+(e?"-"+e:"")+"~%%%%"}},{key:"cacheSurfaceContent",value:function(e,t){var n=this.computeSurfaceCacheState_(t),r=this.getSurfaceFromElementId(e);r.cacheState=n}},{key:"cacheSurfaceRenderAttrs_",value:function(e,t){for(var n=t||[],r=0;r<n.length;r++)this.surfacesRenderAttrs_[n[r]]||(this.surfacesRenderAttrs_[n[r]]={},this.addMissingAttr_(n[r],this.initialConfig_[n[r]])),this.surfacesRenderAttrs_[n[r]][e]=!0}},{key:"checkHasElementTag_",value:function(e,t){return-1!==e.indexOf(' id="'+t+'"')}},{key:"clearSurfaceCache",value:function(e){this.getSurface(e).cacheState=u.Cache.NOT_INITIALIZED}},{key:"compareCacheStates_",value:function(e,t){return e!==u.Cache.NOT_INITIALIZED&&e===t}},{key:"computeSurfaceCacheState_",value:function(e){return e=e||"",r.checkAttrOrderChange()&&(e=this.convertHtmlToBrowserFormat_(e)),l.hashCode(e)}},{key:"convertHtmlToBrowserFormat_",value:function(e){var t=document.createElement("div");return n.append(t,e),t.innerHTML}},{key:"createPlaceholderSurface_",value:function(e,n){var r=n;t.isDefAndNotNull(r)||(r=this.generateSurfaceElementId(e));var i=this.getSurfaceFromElementId(r);return i||(i={surfaceElementId:r},this.addSurface(r,i)),i}},{key:"createSubComponent_",value:function(e,t){return this.components[t]=u.componentsCollector.createComponent(e,t,this.getSurfaceFromElementId(t).componentData),this.components[t]}},{key:"createSurfaceElement_",value:function(e){var t=document.createElement(this.constructor.SURFACE_TAG_NAME_MERGED);return t.id=e,t}},{key:"decorateAsSubComponent",value:function(e){this.decorating_=!0,this.renderAsSubComponent(e),this.decorating_=!1}},{key:"delegate",value:function(e,t,r){var i=n.delegate(this.element,e,t,r);return this.delegateEventHandler_.add(i),i}},{key:"detach",value:function(){return this.inDocument&&(this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.inDocument=!1,this.detached()),this.eventsCollector_.detachAllListeners(),this}},{key:"detached",value:function(){}},{key:"created_",value:function(){this.on("eventsChanged",this.onEventsChanged_),this.addListenersFromObj_(this.events),this.on("attrsChanged",this.handleAttributesChanges_),u.componentsCollector.addComponent(this),this.on("renderSurface",this.defaultRenderSurfaceFn_,!0)}},{key:"decorate",value:function(){return this.decorating_=!0,this.render(),this.decorating_=!1,this}},{key:"defaultRenderSurfaceFn_",value:function(e){var t=e.surfaceElementId,n=this.getSurfaceFromElementId(t);if(n.componentName&&t!==this.id)return void this.renderComponentSurface_(t,e.content);var r=e.content||this.getSurfaceContent_(t),i=e.cacheContent||r,s=n["static"];if(!n["static"]){var a=n.cacheState;this.cacheSurfaceContent(t,i),s=this.compareCacheStates_(n.cacheState,a)}s?this.renderPlaceholderSurfaceContents_(i,t):(this.eventsCollector_.attachListeners(i,t),this.replaceSurfaceContent_(t,n,r))}},{key:"disposeSubComponents_",value:function(e){for(var t=0;t<e.length;t++){var n=this.components[e[t]];n.isDisposed()||(u.componentsCollector.removeComponent(n),n.dispose(),delete this.components[e[t]])}}},{key:"disposeInternal",value:function(){var e=this;this.detach(),this.elementEventProxy_&&(this.elementEventProxy_.dispose(),this.elementEventProxy_=null),this.delegateEventHandler_.removeAllListeners(),this.delegateEventHandler_=null,this.disposeSubComponents_(Object.keys(this.components)),this.components=null,this.generatedIdCount_=null,this.surfacesRenderAttrs_=null,this.eventsCollector_.dispose(),this.eventsCollector_=null,Object.keys(this.surfaceIds_).forEach(function(t){return e.removeSurface(t)}),this.surfaceIds_=null,babelHelpers.get(Object.getPrototypeOf(u.prototype),"disposeInternal",this).call(this)}},{key:"emitRenderSurfaceEvent_",value:function(e,t,n,r){this.emit("renderSurface",{cacheContent:n,content:t,renderAttrs:r||[],surfaceElementId:e,surfaceId:this.getSurfaceId(this.getSurfaceFromElementId(e))})}},{key:"extractListenerInfo_",value:function(e){var n={fn:e};return t.isObject(e)&&!t.isFunction(e)&&(n.selector=e.selector,n.fn=e.fn),t.isString(n.fn)&&(n.fn=this.eventsCollector_.getListenerFn(n.fn)),n}},{key:"syncAttrs_",value:function(){for(var e=this.getAttrNames(),t=0;t<e.length;t++)this.fireAttrChange_(e[t])}},{key:"syncAttrsFromChanges_",value:function(e){for(var t in e)this.fireAttrChange_(t,e[t])}},{key:"findElementById_",value:function(e){return document.getElementById(e)||this.element&&this.element.querySelector("#"+e)}},{key:"findElementInContent_",value:function(e,r){r=t.isString(r)?n.buildFragment(r):r;var i=r.childNodes[0];return i&&i.id===e?i:void 0}},{key:"fireAttrChange_",value:function(e,n){var r=this["sync"+e.charAt(0).toUpperCase()+e.slice(1)];t.isFunction(r)&&(n||(n={newVal:this[e],prevVal:void 0}),r.call(this,n.newVal,n.prevVal))}},{key:"generateSurfaceElementId",value:function(e){return this.generatedIdCount_[e]=(this.generatedIdCount_[e]||0)+1,e+"-s"+this.generatedIdCount_[e]}},{key:"getComponentHtml",value:function(e){return this.wrapContentIfNecessary(e,this.id,this.constructor.ELEMENT_TAG_NAME_MERGED)}},{key:"getComponentsWithPrefix",value:function(e){var t=this,n=Object.keys(this.components).filter(function(t){return 0===t.indexOf(e)}),r={};return n.forEach(function(e){return r[e]=t.components[e]}),r}},{key:"getName",value:function(){return this.constructor.NAME||t.getFunctionName(this.constructor)}},{key:"getElementContent_",value:function(e){return this.addElementSurface_(),this.getRenderer().getSurfaceContent(this.getSurface(this.id),this,e)}},{key:"getElementExtendedContent",value:function(){var e=this.getElementContent_()||"";return this.eventsCollector_.attachListeners(e,this.id),this.cacheSurfaceContent(this.id,e),this.replaceSurfacePlaceholders_(e,this.id,this.getSurface(this.id))}},{key:"getModifiedSurfacesFromChanges_",value:function(e){var t={};for(var n in e)for(var r=Object.keys(this.surfacesRenderAttrs_[n]||{}),i=0;i<r.length;i++)t[r[i]]||(t[r[i]]=[]),t[r[i]].push(n);return t}},{key:"getNonComponentSurfaceHtml",value:function(e,t){return this.wrapContentIfNecessary(t,e,this.constructor.SURFACE_TAG_NAME_MERGED)}},{key:"getRenderer",value:function(){return this.constructor.RENDERER_MERGED}},{key:"getSurface",value:function(e){var t=this.getSurfaceFromElementId(this.getSurfaceElementId(e));return t?t:this.getSurfaceFromElementId(e)}},{key:"getSurfaceContent_",value:function(e){var t=this.getSurfaceFromElementId(e);if(t.componentName&&e!==this.id){var n=c.components[e];return n.wasRendered?"":n.getElementExtendedContent()}return this.getRenderer().getSurfaceContent(t,this)||""}},{key:"getSurfaceElement",value:function(e,t){var n=t||this.getSurface(e);if(!n)return null;if(!n.element)if(n.componentName){var r=c.components[e];r&&(n.element=r.element)}else{var i=this.getSurfaceElementId(e,n);n.element=this.findElementById_(i)||this.createSurfaceElement_(i)}return n.element}},{key:"getSurfaceElementId",value:function(e,t){var n=t||{};return n.surfaceElementId?n.surfaceElementId:n.componentName||this.hasComponentPrefix_(e)?e:this.prefixSurfaceId(e)}},{key:"getSurfaceFromElementId",value:function(e){return u.surfacesCollector.getSurface(e)}},{key:"getSurfaceHtml_",value:function(e,t){var n=e.surfaceElementId;return e.componentName?c.components[n].getComponentHtml(t):this.getNonComponentSurfaceHtml(n,t)}},{key:"getSurfaceId",value:function(e){return e.componentName||!this.hasComponentPrefix_(e.surfaceElementId)?e.surfaceElementId:e.surfaceElementId.substr(this.id.length+1)}},{key:"getSurfaces",value:function(){var e={};return Object.keys(this.surfaceIds_).forEach(function(t){var n=this.getSurfaceFromElementId(t);e[this.getSurfaceId(n)]=n}.bind(this)),e}},{key:"handleAttributesChanges_",value:function(e){this.inDocument&&this.renderSurfacesContent_(this.getModifiedSurfacesFromChanges_(e.changes)),this.syncAttrsFromChanges_(e.changes),this.emit("attrsSynced",e)}},{key:"hasComponentPrefix_",value:function(e){return e.substr(0,this.id.length)===this.id&&(e.length===this.id.length||"-"===e[this.id.length])}},{key:"onEventsChanged_",value:function(e){this.eventsAttrHandler_.removeAllListeners(),this.addListenersFromObj_(e.newVal)}},{key:"makeId_",value:function(){return"metal_c_"+t.getUid(this)}},{key:"mergeElementClasses_",value:function(e){var t={};return e.filter(function(e){return!e||t[e]?!1:(t[e]=!0,!0)}).join(" ")}},{key:"mergeObjects_",value:function(e){return a.mixin.apply(null,[{}].concat(e.reverse()))}},{key:"prefixSurfaceId",value:function(e){return this.id+"-"+e}},{key:"removeSurface",value:function(e){var t=this.getSurfaceElement(e);t&&t.parentNode&&t.parentNode.removeChild(t);var n=this.getSurfaceElementId(e,this.getSurface(e));return u.surfacesCollector.removeSurface(n),this.surfaceIds_[n]=!1,this}},{key:"removeUnusedSurfaces_",value:function(){for(var e=[],t=0;t<this.removedSurfaces_.length;t++){var n=this.removedSurfaces_[t];n.parent||(this.removeSurface(n.surfaceElementId),n.componentName&&e.push(n.surfaceElementId))}this.disposeSubComponents_(e)}},{key:"render",value:function(e,t){if(this.wasRendered)throw new Error(u.Error.ALREADY_RENDERED);return this.addElementSurface_(),this.renderContent_(),this.syncAttrs_(),this.emit("render"),this.attach(e,t),this.wasRendered=!0,this}},{key:"renderAsSubComponent",value:function(e){this.addElementSurface_(),e&&n.isEmpty(this.element)&&this.replaceElementContent_(e),this.syncAttrs_(),this.attach(),this.wasRendered=!0}},{key:"renderComponentSurface_",value:function(e,t){var n=c.components[e];if(n.wasRendered){var r=this.getSurfaceFromElementId(e);u.componentsCollector.updateComponent(e,r.componentData)}else this.decorating_?n.decorateAsSubComponent(t):n.renderAsSubComponent(t)}},{key:"renderContent_",value:function(){var e=this.id;if(this.decorating_){var t=this.getElementExtendedContent(),n=this.computeSurfaceCacheState_(t),r=this.computeSurfaceCacheState_(s.compress(this.element.outerHTML));this.compareCacheStates_(r,n)||this.replaceElementContent_(t)}else this.emitRenderSurfaceEvent_(e)}},{key:"renderElement_",value:function(e,t){var r=this.element;if(r.id=this.id,t||!r.parentNode){var i=n.toElement(e)||this.DEFAULT_ELEMENT_PARENT;i.insertBefore(r,n.toElement(t))}}},{key:"renderPlaceholderSurfaceContents_",value:function(e,t){var n=this;e.replace(u.SURFACE_REGEX,function(e,r){var i=n.createPlaceholderSurface_(t,r);return n.emitRenderSurfaceEvent_(i.surfaceElementId),e})}},{key:"renderSurfacesContent_",value:function(e){this.generatedIdCount_={},this.removedSurfaces_=[];var t=Object.keys(e),n=t.indexOf(this.id);-1!==n&&(t.splice(n,1),t=[this.id].concat(t));for(var r=0;r<t.length;r++)this.getSurfaceFromElementId(t[r]).handled||this.emitRenderSurfaceEvent_(t[r],null,null,e[t[r]]);this.updatePlaceholderSurfaces_(),this.eventsCollector_.detachUnusedListeners(),this.removeUnusedSurfaces_()}},{key:"replaceElementContent_",value:function(e){var t=this.element,r=this.buildFragment_(e),i=this.findElementInContent_(this.id,r);i&&(this.updateElementAttributes_(t,i),r=i.childNodes),n.removeChildren(t),n.append(t,r)}},{key:"replaceSurfaceContent_",value:function(e,t,r){if(r=this.replaceSurfacePlaceholders_(r,e,t),e===this.id)return void this.replaceElementContent_(r);var i=this.getSurfaceElement(e),s=this.buildFragment_(r),a=this.findElementInContent_(e,s);a?(t.element=a,n.replace(i,t.element)):(n.removeChildren(i),n.append(i,s))}},{key:"replaceSurfacePlaceholders_",value:function(e,t,n){n.componentName&&t!==this.id||(this.addToRemovedSurfaces_(n.children||[]),n.children=[]);var r=this;return e.replace(u.SURFACE_REGEX,function(e,i){var s=r.createPlaceholderSurface_(t,i);i=s.surfaceElementId,s.handled=!0,s.parent=t,n.children.push(i);var a=r.getSurfaceContent_(i),l=r.getSurfaceHtml_(s,a),o=r.replaceSurfacePlaceholders_(l,i,s);return r.collectedSurfaces_.push({cacheContent:a,content:o,surface:s}),o})}},{key:"setterElementFn_",value:function(e){var t=n.toElement(e);return t||(t=this.valueElementFn_()),t}},{key:"syncElementClasses",value:function(e,t){var r=this.constructor.ELEMENT_CLASSES_MERGED;e&&(r=r+" "+e),t&&n.removeClasses(this.element,t),n.addClasses(this.element,r)}},{key:"syncVisible",value:function(e){this.element.style.display=e?"":"none"}},{key:"updateElementAttributes_",value:function(e,t){for(var n=t.attributes,r=0;r<n.length;r++)"id"!==n[r].name&&"class"!==n[r].name&&e.setAttribute(n[r].name,n[r].value);e.tagName!==t.tagName}},{key:"updatePlaceholderSurface_",value:function(e){var t=e.surface,r=t.surfaceElementId;t.componentName?(n.replace(this.findElementById_(r),this.getSurfaceElement(r,t)),this.emitRenderSurfaceEvent_(r,e.content,e.cacheContent)):(t.element=null,this.cacheSurfaceContent(r,e.cacheContent),this.eventsCollector_.attachListeners(e.cacheContent,r))}},{key:"updatePlaceholderSurfaces_",value:function(){for(var e=this.collectedSurfaces_.length-1;e>=0;e--)this.updatePlaceholderSurface_(this.collectedSurfaces_[e]),this.collectedSurfaces_[e].surface.handled=!1;this.collectedSurfaces_=[]}},{key:"validatorElementFn_",value:function(e){return t.isElement(e)||t.isString(e)}},{key:"validatorElementClassesFn_",value:function(e){return t.isString(e)}},{key:"validatorEventsFn_",value:function(e){return!t.isDefAndNotNull(e)||t.isObject(e)}},{key:"validatorIdFn_",value:function(e){return t.isString(e)}},{key:"valueElementFn_",value:function(){this.id||(this.id=this.makeId_());var e=this.findElementInContent_(this.id,this.getElementContent_(!0)||"");return e||(e=this.findElementInContent_(this.id,this.getComponentHtml(""))),n.removeChildren(e),n.exitDocument(e),e}},{key:"valueIdFn_",value:function(){var e=this.element;return e&&e.id?e.id:this.makeId_()}},{key:"wrapContentIfNecessary",value:function(e,t,n){return this.checkHasElementTag_(e,t)||(e="<"+n+' id="'+t+'">'+e+"</"+n+">"),e}}]),u}(o);p.componentsCollector=new c,p.surfacesCollector=new f,p.ATTRS={element:{setter:"setterElementFn_",validator:"validatorElementFn_",valueFn:"valueElementFn_",writeOnce:!0},elementClasses:{validator:"validatorElementClassesFn_"},events:{validator:"validatorEventsFn_",value:null},id:{validator:"validatorIdFn_",valueFn:"valueIdFn_",writeOnce:!0},visible:{validator:t.isBoolean,value:!0}},p.ELEMENT_CLASSES="component",p.ELEMENT_TAG_NAME="div",p.RENDERER=u,p.SURFACE_REGEX=/\%\%\%\%~s(?:-([^~:]+))?~\%\%\%\%/g,p.SURFACE_TAG_NAME="div",p.Cache={NOT_INITIALIZED:-2},p.Error={ALREADY_RENDERED:"Component already rendered"},p.INVALID_ATTRS=["components","elementContent"],this.crystal.Component=p}.call(this),function(){var e={},t=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"get",value:function(n,r){return n?r?t.get(n)[r]:e[n]||{}:e}},{key:"set",value:function(t,n){e[t]=n}}]),t}();this.crystal.SoyTemplates=t}.call(this),function(){var e=this.crystal.SoyTemplates,t={interceptFn_:null,getOriginalFn:function(e){return e.originalFn?e.originalFn:e},handleTemplateCall_:function(e,n,r,i,s,a){return t.interceptFn_?t.interceptFn_.call(null,e,n,r,i,s,a):r.call(null,i,s,a)},registerTemplates:function(n){var r=e.get(n);Object.keys(r).forEach(function(e){var i=r[e];i.originalFn||(r[e]=t.handleTemplateCall_.bind(null,n,e,i),r[e].originalFn=i)})},startInterception:function(e){t.interceptFn_=e},stopInterception:function(){t.interceptFn_=null}};this.crystal.SoyAop=t}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.object,r=this.crystal.Component,i=this.crystal.ComponentRegistry,s=this.crystal.ComponentRenderer,a=this.crystal.SoyAop,l=this.crystal.SoyTemplates,o={},c=function(s){function c(){return babelHelpers.classCallCheck(this,c),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(c).apply(this,arguments))}return babelHelpers.inherits(c,s),babelHelpers.createClass(c,null,[{key:"addSurfacesFromTemplates_",value:function(e){for(var t=e.getName(),n=l.get(t),r=Object.keys(n),i=0;i<r.length;i++){var s=r[i],o=a.getOriginalFn(n[s]);if(c.isSurfaceTemplate_(s,o)){var u="content"===s?e.id:s;e.addSurface(u,{renderAttrs:o.params,templateComponentName:t,templateName:s})}}}},{key:"buildComponentConfigData_",value:function(e,t){var n={id:e};for(var r in t)n[r]=t[r];return n}},{key:"buildTemplateData_",value:function(e){var t=e.getAttrNames().filter(function(e){return"element"!==e}),r=e.getSurface(e.id),i=r&&r.componentData?r.componentData:{};return n.mixin(i,e.getAttrs(t))}},{key:"createComponentFromTemplate",value:function(s,o,u){var h=o?t.toElement(o):null,d=n.mixin({id:h?h.id:null},u,{element:h}),v="TemplateComponent"+e.getUid(),f=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(r);return f.RENDERER=c,i.register(f,v),l.set(v,{content:function(e,t,n){return a.getOriginalFn(s)(d,t,n)}}),a.registerTemplates(v),new f(d)}},{key:"decorateFromTemplate",value:function(e,t,n){return c.createComponentFromTemplate(e,t,n).decorate()}},{key:"generateSurfaceElementId",value:function(e,t,n){return n.templateName&&t===e.id&&!c.firstSurfaceFound_[n.templateName]?(c.firstSurfaceFound_[n.templateName]=!0,e.prefixSurfaceId(n.templateName)):e.generateSurfaceElementId(t)}},{key:"getSurfaceContent",value:function(e,t,n){e.surfaceElementId===t.id&&(e.renderAttrs||this.addSurfacesFromTemplates_(t),c.firstSurfaceFound_={}),c.surfaceBeingRendered_=e.surfaceElementId,c.skipInnerCalls_=c.skipInnerCalls_||n;var r=e.templateData;e.templateData=null;var i=c.renderTemplateByName_(t,e.templateComponentName,e.templateName,r);return c.surfaceBeingRendered_=null,c.skipInnerCalls_=!1,i}},{key:"handleComponentCall_",value:function(e,t,n){var r={componentName:t},i=(n||{}).id;return i||(i=c.generateSurfaceElementId(e,c.surfaceBeingRendered_,r)),r.componentData=c.buildComponentConfigData_(i,n),e.buildPlaceholder(i,r)}},{key:"handleInterceptedCall_",value:function(e,t,n,r,i,s,a){return c.skipInnerCalls_?"":"content"===n?this.handleComponentCall_.call(this,e,t,i):this.handleSurfaceCall_.call(this,e,t,n,r,i,s,a)}},{key:"handleSurfaceCall_",value:function(t,n,r,i,s,a,l){var o,u={"static":i["static"],templateComponentName:n,templateData:s,templateName:r};if(e.isDefAndNotNull(s.surfaceElementId))o=s.surfaceElementId;else if(e.isDefAndNotNull(s.surfaceId))o=t.getSurfaceElementId(s.surfaceId.toString());else{if(i["private"])return i.call(null,s,a,l);o=c.generateSurfaceElementId(t,c.surfaceBeingRendered_,u)}return t.buildPlaceholder(o,u)}},{key:"isSurfaceTemplate_",value:function(e,t){return"__deltemplate"!==e.substr(0,13)&&!t["private"]}},{key:"renderFromTemplate",value:function(e,t,n){return c.createComponentFromTemplate(e,t,n).render()}},{key:"renderTemplate_",value:function(e,t,n){a.startInterception(c.handleInterceptedCall_.bind(c,e)),t=a.getOriginalFn(t);var r=t(n||c.buildTemplateData_(e),null,o).content;return a.stopInterception(),r}},{key:"renderTemplateByName_",value:function(t,n,r,i){var s=l.get(n,r);return e.isFunction(s)?c.renderTemplate_(t,s,i):void 0}},{key:"sanitizeHtml",value:function(e){return soydata.VERY_UNSAFE.ordainSanitizedHtml(e)}},{key:"setInjectedData",value:function(e){o=e||{}}}]),c}(s),u=soydata.SanitizedHtml.from;soydata.SanitizedHtml.from=function(e){return e&&"HTML"===e.contentKind&&(e=c.sanitizeHtml(e.content)),u(e)},this.crystal.SoyRenderer=c}.call(this),function(){var e=this.crystal.Component,t=this.crystal.ComponentRegistry,n=this.crystal.SoyAop,r=this.crystal.SoyRenderer,i=this.crystal.SoyTemplates,s=i.get();"undefined"==typeof s.Modal&&(s.Modal={}),s.Modal.content=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'" class="modal component'+soy.$$escapeHtmlAttribute(e.elementClasses?" "+e.elementClasses:"")+'" role="'+soy.$$escapeHtmlAttribute(e.role?e.role:"dialog")+'" aria-labelledby="'+soy.$$escapeHtmlAttribute(e.id)+'-header"><div class="modal-dialog" tabindex="0"><div class="modal-content">'+s.Modal.header(e,null,n)+s.Modal.body(e,null,n)+s.Modal.footer(e,null,n)+"</div></div></div>")},goog.DEBUG&&(s.Modal.content.soyTemplateName="Templates.Modal.content"),s.Modal.body=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<section id="'+soy.$$escapeHtmlAttribute(e.id)+'-body" class="modal-body">'+(e.body?soy.$$escapeHtml(e.body):"")+"</section>")},goog.DEBUG&&(s.Modal.body.soyTemplateName="Templates.Modal.body"),s.Modal.footer=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<footer id="'+soy.$$escapeHtmlAttribute(e.id)+'-footer" class="modal-footer">'+(e.footer?soy.$$escapeHtml(e.footer):"")+"</footer>")},goog.DEBUG&&(s.Modal.footer.soyTemplateName="Templates.Modal.footer"),s.Modal.header=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<header id="'+soy.$$escapeHtmlAttribute(e.id)+'-header" class="modal-header">'+(e.header?'<button type="button" class="close" data-onclick="hide" aria-label="Close"><span aria-hidden="true"></span></button>'+soy.$$escapeHtml(e.header):"")+"</header>")},goog.DEBUG&&(s.Modal.header.soyTemplateName="Templates.Modal.header"),s.Modal.content.params=["id","role"],s.Modal.body.params=["id","body"],s.Modal.footer.params=["footer","id"],s.Modal.header.params=["header","id"];var a=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,null,[{key:"setImpl",value:function(e){t.register(e,"Modal")}}]),n}(e);a.RENDERER=r,a.setImpl(a),n.registerTemplates("Modal"),this.crystal.Modal=a}.call(this),function(){function e(e,t,r,s){var a=n(e),l=t.data(a);if(!l)throw new Error("Tried to call method "+r+" on "+e+" pluginwithout initialing it first.");if(!i(l,r))throw new Error("Plugin "+e+" has no method called "+r);return l[r].apply(l,s)}function t(e,t,r,i){var a=n(e),l=r.data(a);i=$.extend({},i,{element:r[0]}),l?l.setAttrs(i):(l=new t(i).render(),l.on("*",s.bind(null,e,r)),r.data(a,l))}function n(e){return"metal-"+e}function r(n,r,i,s,l){return a.isString(s)?e(n,$(i[0]),s,l):(i.each(function(){t(n,r,$(this),s)}),i)}function i(e,t){return a.isFunction(e[t])&&"_"!==t[0]&&"_"!==t[t.length-1]}function s(e,t,r,i){var s=n(e);t.trigger(s+":"+r,i)}var a=this.crystal.core,l={register:function(e,t){if(!$)throw new Error("jQuery needs to be included in the page for JQueryAdapter to work.");if(!a.isString(e))throw new Error("The name string is required for registering a plugin");if(!a.isFunction(t))throw new Error("The constructor function is required for registering a plugin");$.fn[e]=function(n){var i=Array.prototype.slice.call(arguments,1);return r(e,t,this,n,i)}}};this.crystal.JQueryAdapter=l}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.EventHandler,r=this.crystal.Modal,i=function(e){function r(e){babelHelpers.classCallCheck(this,r);var t=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t.eventHandler_=new n,t}return babelHelpers.inherits(r,e),babelHelpers.createClass(r,[{key:"attached",value:function(){this.autoFocus_(this.autoFocus)}},{key:"autoFocus_",value:function(e){if(this.inDocument&&this.visible&&e){var t=this.element.querySelector(e);t&&t.focus()}}},{key:"detached",value:function(){babelHelpers.get(Object.getPrototypeOf(r.prototype),"detached",this).call(this),this.eventHandler_.removeAllListeners()}},{key:"disposeInternal",value:function(){t.exitDocument(this.overlayElement),this.unrestrictFocus_(),babelHelpers.get(Object.getPrototypeOf(r.prototype),"disposeInternal",this).call(this)}},{key:"handleDocumentFocus_",value:function(e){this.overlay&&!this.element.contains(e.target)&&this.autoFocus_(".modal-dialog")}},{key:"handleKeyup_",value:function(e){27===e.keyCode&&this.hide()}},{key:"hide",value:function(){this.visible=!1}},{key:"restrictFocus_",value:function(){this.restrictFocusHandle_=t.on(document,"focus",this.handleDocumentFocus_.bind(this),!0)}},{key:"shiftFocusBack_",value:function(){this.lastFocusedElement_&&(this.lastFocusedElement_.focus(),this.lastFocusedElement_=null)}},{key:"show",value:function(){this.visible=!0}},{key:"syncHideOnEscape",value:function(e){e?this.eventHandler_.add(t.on(document,"keyup",this.handleKeyup_.bind(this))):this.eventHandler_.removeAllListeners()}},{key:"syncOverlay",value:function(e){var n=e&&this.visible;t[n?"enterDocument":"exitDocument"](this.overlayElement)}},{key:"syncVisible",value:function(e){this.element.style.display=e?"block":"",this.syncOverlay(this.overlay),this.visible?(this.lastFocusedElement_=document.activeElement,this.autoFocus_(this.autoFocus),this.restrictFocus_()):(this.unrestrictFocus_(),this.shiftFocusBack_())}},{key:"unrestrictFocus_",value:function(){this.restrictFocusHandle_&&this.restrictFocusHandle_.removeListener()}},{key:"valueOverlayElementFn_",value:function(){return t.buildFragment('<div class="modal-backdrop fade in"></div>').firstChild}}]),r}(r);i.ELEMENT_CLASSES="modal",i.ATTRS={autoFocus:{validator:function(t){return t===!1||e.isString(t)},value:".close"},body:{},footer:{},header:{},hideOnEscape:{validator:e.isBoolean,value:!0},overlay:{validator:e.isBoolean,value:!0},overlayElement:{initOnly:!0,valueFn:"valueOverlayElementFn_"},role:{validator:e.isString,value:"dialog"}},r.setImpl(i),this.crystal.Modal=i;var s=this.crystal.JQueryAdapter;s.register("modal",i)}.call(this),function(){var e=this.crystal.Component,t=this.crystal.ComponentRegistry,n=this.crystal.SoyAop,r=this.crystal.SoyRenderer,i=this.crystal.SoyTemplates,s=i.get();"undefined"==typeof s.Dropdown&&(s.Dropdown={}),s.Dropdown.content=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'" class="dropdown component'+soy.$$escapeHtmlAttribute(e.elementClasses?" "+e.elementClasses:"")+soy.$$escapeHtmlAttribute(e.expanded?" open":"")+'">'+(e.header?soy.$$escapeHtml(e.header):"")+s.Dropdown.body(e,null,n)+"</div>")},goog.DEBUG&&(s.Dropdown.content.soyTemplateName="Templates.Dropdown.content"),s.Dropdown.body=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<ul id="'+soy.$$escapeHtmlAttribute(e.id)+'-body" class="dropdown-menu">'+(e.body?soy.$$escapeHtml(e.body):"")+"</ul>")},goog.DEBUG&&(s.Dropdown.body.soyTemplateName="Templates.Dropdown.body"),s.Dropdown.content.params=["header","id"],s.Dropdown.body.params=["body","id"];var a=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,null,[{key:"setImpl",value:function(e){t.register(e,"Dropdown")}}]),n}(e);a.RENDERER=r,a.setImpl(a),n.registerTemplates("Dropdown"),this.crystal.Dropdown=a}.call(this),function(){var e=this.crystal.dom,t=this.crystal.EventHandler,n=this.crystal.Dropdown,r=function(n){function r(e){babelHelpers.classCallCheck(this,r);var n=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return n.eventHandler_=new t,n}return babelHelpers.inherits(r,n),babelHelpers.createClass(r,[{key:"attached",value:function(){babelHelpers.get(Object.getPrototypeOf(r.prototype),"attached",this).call(this),this.eventHandler_.add(e.on(document,"click",this.handleDocClick_.bind(this)))}},{key:"detached",value:function(){babelHelpers.get(Object.getPrototypeOf(r.prototype),"detached",this).call(this),this.eventHandler_.removeAllListeners()}},{key:"close",value:function(){this.expanded=!1}},{key:"isOpen",value:function(){return this.expanded}},{key:"handleDocClick_",value:function(e){this.element.contains(e.target)||this.close()}},{key:"open",value:function(){this.expanded=!0}},{key:"syncExpanded",value:function(t){t?e.addClasses(this.element,"open"):e.removeClasses(this.element,"open")}},{key:"syncPosition",value:function(t,n){
n&&e.removeClasses(this.element,"drop"+n.toLowerCase()),e.addClasses(this.element,"drop"+t.toLowerCase())}},{key:"toggle",value:function(){this.expanded=!this.expanded}},{key:"validatePosition_",value:function(e){switch(e.toLowerCase()){case"up":case"down":return!0;default:return!1}}}]),r}(n);r.ATTRS={body:{},header:{},expanded:{value:!1},position:{value:"down",validator:"validatePosition_"}},r.ELEMENT_CLASSES="dropdown",n.setImpl(r),this.crystal.Dropdown=r;var i=this.crystal.JQueryAdapter;i.register("dropdown",r)}.call(this),function(){var e=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"intersectRect",value:function(e,t,n,r,i,s,a,l){return!(i>n||e>a||s>r||t>l)}}]),e}();this.crystal.Geometry=e}.call(this),function(){var e=this.crystal.core,t=this.crystal.Geometry,n=function(){function n(){babelHelpers.classCallCheck(this,n)}return babelHelpers.createClass(n,null,[{key:"getClientHeight",value:function(e){return this.getClientSize_(e,"Height")}},{key:"getClientSize_",value:function(t,n){var r=t;return e.isWindow(t)&&(r=t.document.documentElement),e.isDocument(t)&&(r=t.documentElement),r["client"+n]}},{key:"getClientWidth",value:function(e){return this.getClientSize_(e,"Width")}},{key:"getDocumentRegion_",value:function(e){var t=this.getHeight(e),n=this.getWidth(e);return this.makeRegion(t,t,0,n,0,n)}},{key:"getHeight",value:function(e){return this.getSize_(e,"Height")}},{key:"getOffsetLeft",value:function(e,t){return e.offsetLeft+(t?0:n.getTranslation(e).left)}},{key:"getOffsetTop",value:function(e,t){return e.offsetTop+(t?0:n.getTranslation(e).top)}},{key:"getRegion",value:function(t,n){return e.isDocument(t)||e.isWindow(t)?this.getDocumentRegion_(t):this.makeRegionFromBoundingRect_(t.getBoundingClientRect(),n)}},{key:"getScrollLeft",value:function(t){return e.isWindow(t)?t.pageXOffset:e.isDocument(t)?t.defaultView.pageXOffset:t.scrollLeft}},{key:"getScrollTop",value:function(t){return e.isWindow(t)?t.pageYOffset:e.isDocument(t)?t.defaultView.pageYOffset:t.scrollTop}},{key:"getSize_",value:function(t,n){if(e.isWindow(t))return this.getClientSize_(t,n);if(e.isDocument(t)){var r=t.documentElement;return Math.max(t.body["scroll"+n],r["scroll"+n],t.body["offset"+n],r["offset"+n],r["client"+n])}return Math.max(t["client"+n],t["scroll"+n],t["offset"+n])}},{key:"getTransformMatrixValues",value:function(e){var t=getComputedStyle(e),n=t.msTransform||t.transform||t.webkitTransform||t.mozTransform;if("none"!==n){for(var r=[],i=/([\d-\.\s]+)/g,s=i.exec(n);s;)r.push(s[1]),s=i.exec(n);return r}}},{key:"getTranslation",value:function(e){var t=n.getTransformMatrixValues(e),r={left:0,top:0};return t&&(r.left=parseFloat(6===t.length?t[4]:t[13]),r.top=parseFloat(6===t.length?t[5]:t[14])),r}},{key:"getWidth",value:function(e){return this.getSize_(e,"Width")}},{key:"intersectRegion",value:function(e,n){return t.intersectRect(e.top,e.left,e.bottom,e.right,n.top,n.left,n.bottom,n.right)}},{key:"insideRegion",value:function(e,t){return t.top>=e.top&&t.bottom<=e.bottom&&t.right<=e.right&&t.left>=e.left}},{key:"insideViewport",value:function(e){return this.insideRegion(this.getRegion(window),e)}},{key:"intersection",value:function(e,t){if(!this.intersectRegion(e,t))return null;var n=Math.min(e.bottom,t.bottom),r=Math.min(e.right,t.right),i=Math.max(e.left,t.left),s=Math.max(e.top,t.top);return this.makeRegion(n,n-s,i,r,s,r-i)}},{key:"makeRegion",value:function(e,t,n,r,i,s){return{bottom:e,height:t,left:n,right:r,top:i,width:s}}},{key:"makeRegionFromBoundingRect_",value:function(e,t){var r=t?n.getScrollLeft(document):0,i=t?n.getScrollTop(document):0;return this.makeRegion(e.bottom+i,e.height,e.left+r,e.right+r,e.top+i,e.width)}},{key:"pointInsideRegion",value:function(e,t,r){return n.insideRegion(r,n.makeRegion(t,0,e,e,t,0))}}]),n}();this.crystal.Position=n}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.Attribute,r=this.crystal.Position,i=function(e){function n(e){babelHelpers.classCallCheck(this,n);var r=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e));return r.activeIndex=-1,r.regions=[],r.scrollHandle_=t.on(r.scrollElement,"scroll",r.checkPosition.bind(r)),r.refresh(),r.on("elementChanged",r.refresh),r.on("offsetChanged",r.checkPosition),r.on("scrollElementChanged",r.onScrollElementChanged_),r.on("selectorChanged",r.refresh),r}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"disposeInternal",value:function(){this.deactivateAll(),this.scrollHandle_.dispose(),babelHelpers.get(Object.getPrototypeOf(n.prototype),"disposeInternal",this).call(this)}},{key:"activate",value:function(e){this.activeIndex>=0&&this.deactivate(this.activeIndex),this.activeIndex=e,t.addClasses(this.resolveElement(this.regions[e].link),this.activeClass)}},{key:"checkPosition",value:function(){var e=this.getScrollHeight_(),t=r.getScrollTop(this.scrollElement);if(e<t+this.offset)return void this.activate(this.regions.length-1);var n=this.findBestRegionAt_(t);n!==this.activeIndex&&(-1===n?this.deactivateAll():this.activate(n))}},{key:"deactivate",value:function(e){t.removeClasses(this.resolveElement(this.regions[e].link),this.activeClass)}},{key:"deactivateAll",value:function(){for(var e=0;e<this.regions.length;e++)this.deactivate(e);this.activeIndex=-1}},{key:"findBestRegionAt_",value:function(e){var t=-1,n=e+this.offset+this.scrollElementRegion_.top;if(this.regions.length>0&&n>=this.regions[0].top)for(var r=0;r<this.regions.length;r++){var i=this.regions[r],s=r===this.regions.length-1;if(n>=i.top&&(s||n<this.regions[r+1].top)){t=r;break}}return t}},{key:"getScrollHeight_",value:function(){var e=r.getHeight(this.scrollElement);return e+=this.scrollElementRegion_.top,e-=r.getClientHeight(this.scrollElement)}},{key:"onScrollElementChanged_",value:function(e){this.refresh(),this.scrollHandle_.dispose(),this.scrollHandle_=t.on(e.newVal,"scroll",this.checkPosition.bind(this))}},{key:"refresh",value:function(){this.deactivateAll(),this.scrollElementRegion_=r.getRegion(this.scrollElement),this.scrollHeight_=this.getScrollHeight_(),this.regions=[];for(var e=this.element.querySelectorAll(this.selector),t=r.getScrollTop(this.scrollElement),n=0;n<e.length;++n){var i=e[n];if(i.hash&&i.hash.length>1){var s=document.getElementById(i.hash.substring(1));if(s){var a=r.getRegion(s);this.regions.push({link:i,top:a.top+t,bottom:a.bottom+t})}}}this.sortRegions_(),this.deactivateAll(),this.checkPosition()}},{key:"sortRegions_",value:function(){this.regions.sort(function(e,t){return e.top-t.top})}}]),n}(n);i.ATTRS={activeClass:{validator:e.isString,value:"active"},resolveElement:{validator:e.isFunction,value:e.identityFunction},scrollElement:{setter:t.toElement,value:document},offset:{validator:e.isNumber,value:0},element:{setter:t.toElement},selector:{validator:e.isString,value:"a"}},this.crystal.Scrollspy=i;var s=this.crystal.JQueryAdapter;s.register("scrollspy",i)}.call(this),function(){var e=this.crystal.Component,t=this.crystal.ComponentRegistry,n=this.crystal.SoyAop,r=this.crystal.SoyRenderer,i=this.crystal.SoyTemplates,s=i.get();"undefined"==typeof s.ProgressBar&&(s.ProgressBar={}),s.ProgressBar.content=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'" class="progress component'+soy.$$escapeHtmlAttribute(e.elementClasses?" "+e.elementClasses:"")+'" role="progressbar" tabindex="0"><div class="progress-bar"></div></div>')},goog.DEBUG&&(s.ProgressBar.content.soyTemplateName="Templates.ProgressBar.content"),s.ProgressBar.content.params=["id"];var a=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,null,[{key:"setImpl",value:function(e){t.register(e,"ProgressBar")}}]),n}(e);a.RENDERER=r,a.setImpl(a),n.registerTemplates("ProgressBar"),this.crystal.ProgressBar=a}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.ProgressBar,r=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"getBarElement",value:function(){return this.barElement_||(this.barElement_=this.element.childNodes[0]),this.barElement_}},{key:"setterValueFn_",value:function(e){return e<this.min&&(e=this.min),e>this.max&&(e=this.max),e}},{key:"syncBarClass",value:function(e,n){var r=this.getBarElement();t.removeClasses(r,n),t.addClasses(r,e)}},{key:"syncLabel",value:function(){var e=this.getBarElement();t.removeChildren(e),this.label&&t.append(e,this.label)}},{key:"syncMax",value:function(e){e<this.value?this.value=e:this.updateBar_(),this.element.setAttribute("aria-valuemax",this.max)}},{key:"syncMin",value:function(e){e>this.value?this.value=e:this.updateBar_(),this.element.setAttribute("aria-valuemin",this.min)}},{key:"syncValue",value:function(){this.updateBar_(),this.element.setAttribute("aria-valuenow",this.value)}},{key:"updateBar_",value:function(){var e=this.getBarElement(),t=Math.floor(100*(this.value-this.min)/(this.max-this.min));e.style.width=t+"%"}}]),n}(n);r.ATTRS={barClass:{validator:e.isString},label:{validator:function(t){return!e.isDefAndNotNull(t)||e.isString(t)}},max:{validator:e.isNumber,value:100},min:{validator:e.isNumber,value:0},value:{setter:"setterValueFn_",validator:e.isNumber,value:0}},r.ELEMENT_CLASSES="progress",n.setImpl(r),this.crystal.ProgressBar=r;var i=this.crystal.JQueryAdapter;i.register("progressBar",r)}.call(this),function(){var e=this.crystal.core,t=this.crystal.Attribute,n=this.crystal.Position,r=function(t){function r(e){babelHelpers.classCallCheck(this,r);var t=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t.scrollTimeout_=null,t}return babelHelpers.inherits(r,t),babelHelpers.createClass(r,[{key:"disposeInternal",value:function(){babelHelpers.get(Object.getPrototypeOf(r.prototype),"disposeInternal",this).call(this),this.stop()}},{key:"getRegionWithoutScroll_",value:function(t){if(e.isDocument(t)){var r=window.innerHeight,i=window.innerWidth;return n.makeRegion(r,r,0,i,0,i)}return n.getRegion(t)}},{key:"scroll",value:function(e,t,n){this.stop(),this.scrollTimeout_=setTimeout(this.scrollInternal_.bind(this,e,t,n),this.delay)}},{key:"scrollElement_",value:function(t,n,r){e.isDocument(t)?window.scrollBy(n,r):(t.scrollTop+=r,t.scrollLeft+=n)}},{key:"scrollInternal_",value:function(e,t,r){for(var i=0;i<e.length;i++){var s=this.getRegionWithoutScroll_(e[i]);if(n.pointInsideRegion(t,r,s)){var a=0,l=0,o=n.getScrollTop(e[i]),c=n.getScrollLeft(e[i]);if(c>0&&Math.abs(t-s.left)<=this.maxDistance?a-=this.speed:Math.abs(t-s.right)<=this.maxDistance&&(a+=this.speed),o>0&&Math.abs(r-s.top)<=this.maxDistance?l-=this.speed:Math.abs(r-s.bottom)<=this.maxDistance&&(l+=this.speed),a||l){this.scrollElement_(e[i],a,l),this.scroll(e,t,r);break}}}}},{key:"stop",value:function(){clearTimeout(this.scrollTimeout_)}}]),r}(t);r.ATTRS={delay:{validator:e.isNumber,value:50},maxDistance:{validator:e.isNumber,value:20},speed:{validator:e.isNumber,value:20}},this.crystal.DragAutoScroll=r}.call(this),function(){var e=this.crystal.dom,t=this.crystal.EventEmitter,n=this.crystal.EventHandler,r=this.crystal.Position,i=function(t){function i(){babelHelpers.classCallCheck(this,i);var e=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this));return e.handler_=new n,e.scrollPositions_=[],e}return babelHelpers.inherits(i,t),babelHelpers.createClass(i,[{key:"disposeInternal",value:function(){babelHelpers.get(Object.getPrototypeOf(i.prototype),"disposeInternal",this).call(this),this.stop(),this.handler_=null}},{key:"handleScroll_",value:function(e,t){var n={scrollLeft:r.getScrollLeft(t.currentTarget),scrollTop:r.getScrollTop(t.currentTarget)},i=this.scrollPositions_[e];this.scrollPositions_[e]=n,this.emit("scrollDelta",{deltaX:n.scrollLeft-i.scrollLeft,deltaY:n.scrollTop-i.scrollTop})}},{key:"start",value:function(t,n){if("fixed"!==getComputedStyle(t).position)for(var i=0;i<n.length;i++)if(e.contains(n[i],t)){this.scrollPositions_.push({scrollLeft:r.getScrollLeft(n[i]),scrollTop:r.getScrollTop(n[i])});var s=this.scrollPositions_.length-1;this.handler_.add(e.on(n[i],"scroll",this.handleScroll_.bind(this,s)))}}},{key:"stop",value:function(){this.handler_.removeAllListeners(),this.scrollPositions_=[]}}]),i}(t);this.crystal.DragScrollDelta=i}.call(this),function(){var e=this.crystal.dom,t=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"attachDocListeners",value:function(n,r){var i=document;n&&(i=t.getDocShim(),i.style.display="block");var s=Object.keys(r);return s.map(function(t){var n="touch"===t.substr(0,5);return e.on(n?document:i,t,r[t])})}},{key:"getDocShim",value:function(){return t.docShim_||(t.docShim_=document.createElement("div"),t.docShim_.className="shim",t.docShim_.style.position="fixed",t.docShim_.style.top=0,t.docShim_.style.left=0,t.docShim_.style.width="100%",t.docShim_.style.height="100%",t.docShim_.style.display="none",t.docShim_.style.opacity=0,t.docShim_.style.zIndex=9999,e.enterDocument(t.docShim_)),t.docShim_}},{key:"hideDocShim",value:function(){t.getDocShim().style.display="none"}},{key:"reset",value:function(){t.docShim_&&(e.exitDocument(t.docShim_),t.docShim_=null)}}]),t}();t.docShim_=null,this.crystal.DragShim=t}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.object,r=this.crystal.Attribute,i=this.crystal.DragAutoScroll,s=this.crystal.DragScrollDelta,a=this.crystal.DragShim,l=this.crystal.EventHandler,o=this.crystal.Position,c=function(r){function c(e){babelHelpers.classCallCheck(this,c);var n=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(c).call(this,e));return n.activeDragPlaceholder_=null,n.activeDragSource_=null,n.distanceDragged_=0,n.dragging_=!1,n.dragHandler_=new l,n.dragScrollDelta_=new s,n.mousePos_=null,n.mouseSourceDelta_=null,n.sourceHandler_=new l,n.sourceRegion_=null,n.sourceRelativePos_=null,n.attachSourceEvents_(),n.on(c.Events.DRAG,n.defaultDragFn_,!0),n.on(c.Events.END,n.defaultEndFn_,!0),n.on("sourcesChanged",n.handleSourcesChanged_.bind(n)),n.dragScrollDelta_.on("scrollDelta",n.handleScrollDelta_.bind(n)),t.on(document,"keydown",n.handleKeyDown_.bind(n)),n}return babelHelpers.inherits(c,r),babelHelpers.createClass(c,[{key:"attachSourceEvents_",value:function(){for(var n={keydown:this.handleSourceKeyDown_.bind(this),mousedown:this.handleDragStartEvent_.bind(this),touchstart:this.handleDragStartEvent_.bind(this)},r=Object.keys(n),i=0;i<r.length;i++){var s=n[r[i]];e.isString(this.sources)?this.sourceHandler_.add(t.delegate(this.container,r[i],this.sources,s)):this.sourceHandler_.add(t.on(this.sources,r[i],s))}}},{key:"buildEventObject_",value:function(){return{placeholder:this.activeDragPlaceholder_,source:this.activeDragSource_,relativeX:this.sourceRelativePos_.x,relativeY:this.sourceRelativePos_.y,x:this.sourceRegion_.left,y:this.sourceRegion_.top}}},{key:"calculateInitialPosition_",value:function(t){this.sourceRegion_=n.mixin({},o.getRegion(this.activeDragSource_,!0)),this.sourceRelativePos_={x:this.activeDragSource_.offsetLeft,y:this.activeDragSource_.offsetTop},e.isDef(t.clientX)&&(this.mousePos_={x:t.clientX,y:t.clientY},this.mouseSourceDelta_={x:this.sourceRegion_.left-this.mousePos_.x,y:this.sourceRegion_.top-this.mousePos_.y})}},{key:"canStartDrag_",value:function(t){return!this.disabled&&(!e.isDef(t.button)||0===t.button)&&!this.isDragging()&&this.isWithinHandle_(t.target)}},{key:"cleanUpAfterDragging_",value:function(){this.activeDragPlaceholder_&&(this.activeDragPlaceholder_.setAttribute("aria-grabbed","false"),t.removeClasses(this.activeDragPlaceholder_,this.draggingClass),this.dragPlaceholder===c.Placeholder.CLONE&&t.exitDocument(this.activeDragPlaceholder_)),this.activeDragPlaceholder_=null,this.activeDragSource_=null,this.sourceRegion_=null,this.sourceRelativePos_=null,this.mousePos_=null,this.mouseSourceDelta_=null,this.dragging_=!1,this.dragHandler_.removeAllListeners()}},{key:"cloneActiveDrag_",value:function(){var e=this.activeDragSource_.cloneNode(!0);return e.style.position="absolute",e.style.left=this.sourceRelativePos_.x+"px",e.style.top=this.sourceRelativePos_.y+"px",t.append(this.activeDragSource_.parentNode,e),e}},{key:"constrain_",value:function(e){this.constrainToAxis_(e),this.constrainToSteps_(e),this.constrainToRegion_(e)}},{key:"constrainToAxis_",value:function(e){"x"===this.axis?(e.top=this.sourceRegion_.top,e.bottom=this.sourceRegion_.bottom):"y"===this.axis&&(e.left=this.sourceRegion_.left,e.right=this.sourceRegion_.right)}},{key:"constrainToRegion_",value:function(t){var n=this.constrain;n&&(e.isElement(n)&&(n=o.getRegion(n,!0)),t.left<n.left?t.left=n.left:t.right>n.right&&(t.left-=t.right-n.right),t.top<n.top?t.top=n.top:t.bottom>n.bottom&&(t.top-=t.bottom-n.bottom),t.right=t.left+t.width,t.bottom=t.top+t.height)}},{key:"constrainToSteps_",value:function(e){var t=e.left-this.sourceRegion_.left,n=e.top-this.sourceRegion_.top;e.left-=t%this.steps.x,e.right=e.left+e.width,e.top-=n%this.steps.y,e.bottom=e.top+e.height}},{key:"createActiveDragPlaceholder_",value:function(){var t=this.dragPlaceholder;t===c.Placeholder.CLONE?this.activeDragPlaceholder_=this.cloneActiveDrag_():e.isElement(t)?this.activeDragPlaceholder_=t:this.activeDragPlaceholder_=this.activeDragSource_}},{key:"defaultDragFn_",value:function(){this.moveToPosition_(this.activeDragPlaceholder_)}},{key:"defaultEndFn_",value:function(){this.moveToPosition_(this.activeDragSource_)}},{key:"disposeInternal",value:function(){this.cleanUpAfterDragging_(),this.dragHandler_=null,this.dragScrollDelta_.dispose(),this.dragScrollDelta_=null,this.sourceHandler_.removeAllListeners(),this.sourceHandler_=null,babelHelpers.get(Object.getPrototypeOf(c.prototype),"disposeInternal",this).call(this)}},{key:"getActiveDrag",value:function(){return this.activeDragSource_}},{key:"handleDragEndEvent_",value:function(){this.autoScroll&&this.autoScroll.stop(),this.dragScrollDelta_.stop(),a.hideDocShim(),this.emit(c.Events.END,this.buildEventObject_()),this.cleanUpAfterDragging_()}},{key:"handleDragMoveEvent_",value:function(e){var t=e.targetTouches?e.targetTouches[0]:e,n=t.clientX-this.mousePos_.x,r=t.clientY-this.mousePos_.y;this.mousePos_.x=t.clientX,this.mousePos_.y=t.clientY,(this.isDragging()||this.hasReachedMinimumDistance_(n,r))&&(this.isDragging()||(this.startDragging_(),this.dragScrollDelta_.start(this.activeDragPlaceholder_,this.scrollContainers)),this.autoScroll&&this.autoScroll.scroll(this.scrollContainers,this.mousePos_.x,this.mousePos_.y),this.updatePositionFromMouse())}},{key:"handleDragStartEvent_",value:function(e){this.activeDragSource_=e.delegateTarget||e.currentTarget,this.canStartDrag_(e)&&(this.calculateInitialPosition_(e.targetTouches?e.targetTouches[0]:e),e.preventDefault(),"keydown"===e.type?this.startDragging_():(this.dragHandler_.add.apply(this.dragHandler_,a.attachDocListeners(this.useShim,{mousemove:this.handleDragMoveEvent_.bind(this),touchmove:this.handleDragMoveEvent_.bind(this),mouseup:this.handleDragEndEvent_.bind(this),touchend:this.handleDragEndEvent_.bind(this)})),this.distanceDragged_=0))}},{key:"handleKeyDown_",value:function(e){27===e.keyCode&&this.isDragging()&&this.handleDragEndEvent_()}},{key:"handleScrollDelta_",value:function(e){this.mouseSourceDelta_.x+=e.deltaX,this.mouseSourceDelta_.y+=e.deltaY,this.updatePositionFromMouse()}},{key:"handleSourceKeyDown_",value:function(e){if(this.isDragging()){var t=e.delegateTarget||e.currentTarget;if(t!==this.activeDragSource_)return;if(e.keyCode>=37&&e.keyCode<=40){var n=0,r=0,i=this.keyboardSpeed>=this.steps.x?this.keyboardSpeed:this.steps.x,s=this.keyboardSpeed>=this.steps.y?this.keyboardSpeed:this.steps.y;37===e.keyCode?n-=i:38===e.keyCode?r-=s:39===e.keyCode?n+=i:r+=s,this.updatePositionFromDelta(n,r),e.preventDefault()}else(13===e.keyCode||32===e.keyCode||27===e.keyCode)&&this.handleDragEndEvent_()}else(13===e.keyCode||32===e.keyCode)&&this.handleDragStartEvent_(e)}},{key:"handleSourcesChanged_",value:function(){this.sourceHandler_.removeAllListeners(),this.attachSourceEvents_()}},{key:"hasReachedMinimumDistance_",value:function(e,t){return this.distanceDragged_+=Math.abs(e)+Math.abs(t),this.distanceDragged_>=this.minimumDragDistance}},{key:"isDragging",value:function(){return this.dragging_}},{key:"isWithinHandle_",value:function(n){var r=this.handles;return r?e.isString(r)?t.match(n,r+", "+r+" *"):t.contains(r,n):!0}},{key:"moveToPosition_",value:function(e){e.style.left=this.sourceRelativePos_.x+"px",e.style.top=this.sourceRelativePos_.y+"px"}},{key:"setterAutoScrollFn_",value:function(e){return e!==!1?new i(e):void 0}},{key:"setterConstrainFn",value:function(n){return e.isString(n)&&(n=t.toElement(n)),n}},{key:"setterScrollContainersFn_",value:function(e){var t=this.toElements_(e);return t.push(document),t}},{key:"startDragging_",value:function(){this.dragging_=!0,this.createActiveDragPlaceholder_(),t.addClasses(this.activeDragPlaceholder_,this.draggingClass),this.activeDragPlaceholder_.setAttribute("aria-grabbed","true")}},{key:"toElements_",value:function(t){if(e.isString(t)){var n=this.container.querySelectorAll(t);return Array.prototype.slice.call(n,0)}return t?[t]:[]}},{key:"updatePosition",value:function(e){this.constrain_(e);var t=e.left-this.sourceRegion_.left,n=e.top-this.sourceRegion_.top;(0!==t||0!==n)&&(this.sourceRegion_=e,this.sourceRelativePos_.x+=t,this.sourceRelativePos_.y+=n,this.emit(c.Events.DRAG,this.buildEventObject_()))}},{key:"updatePositionFromDelta",value:function(e,t){var r=n.mixin({},this.sourceRegion_);r.left+=e,r.right+=e,r.top+=t,r.bottom+=t,this.updatePosition(r)}},{key:"updatePositionFromMouse",value:function(){var e={height:this.sourceRegion_.height,left:this.mousePos_.x+this.mouseSourceDelta_.x,top:this.mousePos_.y+this.mouseSourceDelta_.y,width:this.sourceRegion_.width};e.right=e.left+e.width,e.bottom=e.top+e.height,this.updatePosition(e)}},{key:"validateElementOrString_",value:function(t){return e.isString(t)||e.isElement(t)}},{key:"validatorConstrainFn",value:function(t){return e.isString(t)||e.isObject(t)}}]),c}(r);c.ATTRS={autoScroll:{setter:"setterAutoScrollFn_",value:!1,writeOnce:!0},axis:{validator:e.isString},constrain:{setter:"setterConstrainFn",validator:"validatorConstrainFn"},container:{setter:t.toElement,validator:"validateElementOrString_",value:document},disabled:{validator:e.isBoolean,value:!1},draggingClass:{validator:e.isString,value:"dragging"},dragPlaceholder:{validator:"validateElementOrString_"},handles:{validator:"validateElementOrString_"},keyboardSpeed:{validator:e.isNumber,value:10},minimumDragDistance:{validator:e.isNumber,value:5,writeOnce:!0},scrollContainers:{setter:"setterScrollContainersFn_",validator:"validateElementOrString_"},sources:{validator:"validateElementOrString_"},steps:{validator:e.isObject,valueFn:function(){return{x:1,y:1}}},useShim:{value:!0}},c.Events={DRAG:"drag",END:"end"},c.Placeholder={CLONE:"clone"},this.crystal.Drag=c}.call(this),function(){var e=this.crystal.Component,t=this.crystal.ComponentRegistry,n=this.crystal.SoyAop,r=this.crystal.SoyRenderer,i=this.crystal.SoyTemplates,s=i.get();"undefined"==typeof s.Slider&&(s.Slider={}),s.Slider.content=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'" class="slider component'+soy.$$escapeHtmlAttribute(e.elementClasses?" "+e.elementClasses:"")+'">'+s.Slider.input(e,null,n)+s.Slider.label(e,null,n)+s.Slider.rail(e,null,n)+"</div>")},goog.DEBUG&&(s.Slider.content.soyTemplateName="Templates.Slider.content"),s.Slider.input=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'-input"><input name="'+soy.$$escapeHtmlAttribute(e.inputName?e.inputName:e.id)+'" type="hidden" value="'+soy.$$escapeHtmlAttribute(e.value)+'"></div>')},goog.DEBUG&&(s.Slider.input.soyTemplateName="Templates.Slider.input"),s.Slider.label=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'-label"><span>'+soy.$$escapeHtml(e.value)+"</span></div>")},goog.DEBUG&&(s.Slider.label.soyTemplateName="Templates.Slider.label"),s.Slider.rail=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'-rail"><div class="rail" data-onmousedown="onRailMouseDown_"><div class="rail-active"></div><div class="rail-handle"><div class="handle" tabindex="0"></div></div></div></div>')},goog.DEBUG&&(s.Slider.rail.soyTemplateName="Templates.Slider.rail"),s.Slider.content.params=["id"],s.Slider.input.params=["id","inputName","value"],s.Slider.label.params=["id","value"],s.Slider.rail.params=["id"];var a=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,null,[{key:"setImpl",value:function(e){t.register(e,"Slider")}}]),n}(e);a.RENDERER=r,a.setImpl(a),n.registerTemplates("Slider"),this.crystal.Slider=a}.call(this),function(){var e=this.crystal.core,t=this.crystal.Drag,n=this.crystal.Position,r=this.crystal.Slider,i=function(e){function r(e){babelHelpers.classCallCheck(this,r);var t=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t.elements_=new Map,t}return babelHelpers.inherits(r,e),babelHelpers.createClass(r,[{key:"attached",value:function(){this.drag_=new t({constrain:this.getElement_(".rail"),handles:this.getElement_(".handle"),sources:this.getElement_(".rail-handle")}),this.elementRegion_=n.getRegion(this.element),this.attachDragEvents_()}},{key:"attachDragEvents_",value:function(){this.drag_.on(t.Events.DRAG,this.updateValueFromDragData_.bind(this)),this.drag_.on(t.Events.END,this.updateValueFromDragData_.bind(this))}},{key:"disposeInternal",value:function(){babelHelpers.get(Object.getPrototypeOf(r.prototype),"disposeInternal",this).call(this),this.drag_.dispose(),this.elements_=null,this.elementRegion_=null}},{key:"getElement_",value:function(e){var t=this.elements_.get(e);return t||(t=this.element.querySelector(e),this.elements_.set(e,t)),t}},{key:"onRailMouseDown_",value:function(e){(e.target===this.getElement_(".rail")||e.target===this.getElement_(".rail-active"))&&this.updateValue_(e.offsetX,0)}},{key:"syncMax",value:function(e){e<this.value?this.value=e:this.updateHandlePosition_()}},{key:"syncMin",value:function(e){e>this.value?this.value=e:this.updateHandlePosition_()}},{key:"syncValue",value:function(){this.updateHandlePosition_()}},{key:"updateHandlePosition_",value:function(){var e=100*(this.value-this.min)/(this.max-this.min)+"%";this.drag_&&this.drag_.isDragging()||(this.getElement_(".rail-handle").style.left=e),this.getElement_(".rail-active").style.width=e}},{key:"updateValue_",value:function(e,t){this.value=Math.round(t+e/this.elementRegion_.width*(this.max-this.min))}},{key:"updateValueFromDragData_",value:function(e){this.updateValue_(e.relativeX,this.min)}}]),r}(r);i.ATTRS={inputName:{validator:e.isString},max:{value:100},min:{value:0},value:{validator:function(t){return e.isNumber(t)&&this.min<=t&&t<=this.max},value:80}},i.ELEMENT_CLASSES="slider",r.setImpl(i),this.crystal.Slider=i;var s=this.crystal.JQueryAdapter;s.register("slider",i)}.call(this),function(){var e=this.crystal.Position,t=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"align",value:function(t,n,r){var i=this.suggestAlignBestRegion(t,n,r),s=i.region,a=window.getComputedStyle(t,null);if("fixed"!==a.getPropertyValue("position")){s.top+=window.pageYOffset,s.left+=window.pageXOffset;for(var l=t;l=l.offsetParent;)s.top-=e.getOffsetTop(l),s.left-=e.getOffsetLeft(l)}return t.style.top=s.top+"px",t.style.left=s.left+"px",i.position}},{key:"getAlignBestRegion",value:function(e,n,r){return t.suggestAlignBestRegion(e,n,r).region}},{key:"getAlignRegion",value:function(n,r,i){var s=e.getRegion(r),a=e.getRegion(n),l=0,o=0;switch(i){case t.Top:l=s.top-a.height,o=s.left+s.width/2-a.width/2;break;case t.Right:l=s.top+s.height/2-a.height/2,o=s.left+s.width;break;case t.Bottom:l=s.bottom,o=s.left+s.width/2-a.width/2;break;case t.Left:l=s.top+s.height/2-a.height/2,o=s.left-a.width}return{bottom:l+a.height,height:a.height,left:o,right:o+a.width,top:l,width:a.width}}},{key:"isValidPosition",value:function(e){return e>=0&&3>=e}},{key:"suggestAlignBestRegion",value:function(t,n,r){for(var i=0,s=r,a=this.getAlignRegion(t,n,s),l=s,o=a,c=e.getRegion(window),u=0;4>u;){if(e.intersectRegion(c,o)){var h=e.intersection(c,o),d=h.width*h.height;if(d>i&&(i=d,a=o,s=l),e.insideViewport(o))break}l=(r+ ++u)%4,o=this.getAlignRegion(t,n,l)}return{position:s,region:a}}}]),t}();t.Top=0,t.Right=1,t.Bottom=2,t.Left=3,this.crystal.Align=t}.call(this),function(){var e=this.crystal.dom,t=this.crystal.features,n={mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"};Object.keys(n).forEach(function(t){e.registerCustomEvent(t,{delegate:!0,handler:function(e,n){var r=n.relatedTarget,i=n.delegateTarget;return!r||r!==i&&!i.contains(r)?(n.customType=t,e(n)):void 0},originalEvent:n[t]})});var r={animation:"animationend",transition:"transitionend"};Object.keys(r).forEach(function(n){var i=r[n];e.registerCustomEvent(i,{event:!0,delegate:!0,handler:function(e,t){return t.customType=i,e(t)},originalEvent:t.checkAnimationEventName()[n]})})}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.Align,r=this.crystal.Component,i=this.crystal.EventHandler,s=this.crystal.SoyRenderer,a=function(e){function n(e){babelHelpers.classCallCheck(this,n);var t=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e));return t.eventHandler_=new i,t}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"attached",value:function(){this.align(),this.syncTriggerEvents(this.triggerEvents)}},{key:"detached",value:function(){this.eventHandler_.removeAllListeners()}},{key:"align",value:function(e){this.syncAlignElement(e||this.alignElement)}},{key:"callAsync_",value:function(e,t){clearTimeout(this.delay_),this.delay_=setTimeout(e.bind(this),t)}},{key:"handleHide",value:function(e){var t=e.delegateTarget,n=t&&t!==this.alignElement;this.callAsync_(function(){this.locked_||(n?this.alignElement=t:(this.visible=!1,this.syncVisible(!1)))},this.delay[1])}},{key:"handleShow",value:function(e){var t=e.delegateTarget;babelHelpers.get(Object.getPrototypeOf(n.prototype),"syncVisible",this).call(this,!0),this.callAsync_(function(){this.alignElement=t,this.visible=!0},this.delay[0])}},{key:"handleToggle",value:function(e){this.visible?this.handleHide(e):this.handleShow(e)}},{key:"lock",value:function(){this.locked_=!0}},{key:"unlock",value:function(e){this.locked_=!1,this.handleHide(e)}},{key:"syncAlignElement",value:function(e,t){if(t&&e.removeAttribute("aria-describedby"),e&&(this.visible?e.setAttribute("aria-describedby",this.id):e.removeAttribute("aria-describedby"),this.inDocument)){var r=n.Align.align(this.element,e,this.position);this.updatePositionCSS(r)}}},{key:"syncPosition",value:function(){this.syncAlignElement(this.alignElement)}},{key:"syncSelector",value:function(){this.syncTriggerEvents(this.triggerEvents)}},{key:"syncTriggerEvents",value:function(e){if(this.inDocument){this.eventHandler_.removeAllListeners();var n=this.selector;n&&(this.eventHandler_.add(this.on("mouseenter",this.lock),this.on("mouseleave",this.unlock)),e[0]===e[1]?this.eventHandler_.add(t.delegate(document,e[0],n,this.handleToggle.bind(this))):this.eventHandler_.add(t.delegate(document,e[0],n,this.handleShow.bind(this)),t.delegate(document,e[1],n,this.handleHide.bind(this))));
}}},{key:"syncVisible",value:function(){this.align()}},{key:"updatePositionCSS",value:function(e){t.removeClasses(this.element,n.PositionClasses.join(" ")),t.addClasses(this.element,n.PositionClasses[e])}}]),n}(r);a.Align=n,a.ATTRS={alignElement:{setter:t.toElement},delay:{validator:Array.isArray,value:[500,250]},triggerEvents:{validator:Array.isArray,value:["mouseenter","mouseleave"]},selector:{validator:e.isString},content:{},position:{validator:a.Align.isValidPosition,value:a.Align.Bottom}},a.PositionClasses=["top","right","bottom","left"],a.RENDERER=s,this.crystal.TooltipBase=a;var l=this.crystal.JQueryAdapter;l.register("tooltipBase",a)}.call(this),function(){var e=this.crystal.Component,t=this.crystal.ComponentRegistry,n=this.crystal.SoyAop,r=this.crystal.SoyRenderer,i=this.crystal.SoyTemplates,s=i.get();"undefined"==typeof s.Tooltip&&(s.Tooltip={}),s.Tooltip.content=function(e,t,n){var r="",i=["top","right","bottom","left"],a=null!=e.position?i[e.position]:"bottom";return r+='<div id="'+soy.$$escapeHtmlAttribute(e.id)+'" class="tooltip component '+soy.$$escapeHtmlAttribute(a)+soy.$$escapeHtmlAttribute(e.elementClasses?" "+e.elementClasses:"")+'" role="tooltip"><div class="tooltip-arrow"></div>'+s.Tooltip.inner(e,null,n)+"</div>",soydata.VERY_UNSAFE.ordainSanitizedHtml(r)},goog.DEBUG&&(s.Tooltip.content.soyTemplateName="Templates.Tooltip.content"),s.Tooltip.inner=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<section id="'+soy.$$escapeHtmlAttribute(e.id)+'-inner" class="tooltip-inner">'+soy.$$escapeHtml(e.content?e.content:"")+"</section>")},goog.DEBUG&&(s.Tooltip.inner.soyTemplateName="Templates.Tooltip.inner"),s.Tooltip.content.params=["id"],s.Tooltip.inner.params=["content","id"];var a=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,null,[{key:"setImpl",value:function(e){t.register(e,"Tooltip")}}]),n}(e);a.RENDERER=r,a.setImpl(a),n.registerTemplates("Tooltip"),this.crystal.Tooltip=a}.call(this),function(){var e=this.crystal.ComponentRegistry,t=this.crystal.TooltipBase,n=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"syncVisible",value:function(e){this.element.style.opacity=e?1:"",babelHelpers.get(Object.getPrototypeOf(t.prototype),"syncVisible",this).call(this,e)}}]),t}(t);n.Align=t.Align,n.ELEMENT_CLASSES="tooltip",e.register(n),this.crystal.Tooltip=n;var r=this.crystal.JQueryAdapter;r.register("tooltip",n)}.call(this),function(){var e=this.crystal.Component,t=this.crystal.ComponentRegistry,n=this.crystal.SoyAop,r=this.crystal.SoyRenderer,i=this.crystal.SoyTemplates,s=i.get();"undefined"==typeof s.Popover&&(s.Popover={}),s.Popover.content=function(e,t,n){var r="",i=["top","right","bottom","left"],a=null!=e.position?i[e.position]:"bottom";return r+='<div id="'+soy.$$escapeHtmlAttribute(e.id)+'" class="popover component '+soy.$$escapeHtmlAttribute(a)+soy.$$escapeHtmlAttribute(e.elementClasses?" "+e.elementClasses:"")+'" role="tooltip"><div class="arrow"></div>'+s.Popover.title(e,null,n)+s.Popover.innerContent(e,null,n)+"</div>",soydata.VERY_UNSAFE.ordainSanitizedHtml(r)},goog.DEBUG&&(s.Popover.content.soyTemplateName="Templates.Popover.content"),s.Popover.title=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<h3 id="'+soy.$$escapeHtmlAttribute(e.id)+'-title" class="popover-title'+soy.$$escapeHtmlAttribute(e.title?"":" hidden")+'">'+soy.$$escapeHtml(e.title)+"</h3>")},goog.DEBUG&&(s.Popover.title.soyTemplateName="Templates.Popover.title"),s.Popover.innerContent=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'-innerContent" class="popover-content"><p>'+soy.$$escapeHtml(e.content?e.content:"")+"</p></div>")},goog.DEBUG&&(s.Popover.innerContent.soyTemplateName="Templates.Popover.innerContent"),s.Popover.content.params=["id"],s.Popover.title.params=["id","title"],s.Popover.innerContent.params=["content","id"];var a=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,null,[{key:"setImpl",value:function(e){t.register(e,"Popover")}}]),n}(e);a.RENDERER=r,a.setImpl(a),n.registerTemplates("Popover"),this.crystal.Popover=a}.call(this),function(){var e=this.crystal.core,t=this.crystal.TooltipBase,n=this.crystal.Popover,r=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"syncVisible",value:function(e){this.element.style.display=e?"block":"",babelHelpers.get(Object.getPrototypeOf(t.prototype),"syncVisible",this).call(this,e)}}]),t}(t);r.ATTRS={title:{validator:e.isString},triggerEvents:{validator:Array.isArray,value:["click","click"]}},r.Align=t.Align,r.ELEMENT_CLASSES="popover",n.setImpl(r),this.crystal.Popover=r;var i=this.crystal.JQueryAdapter;i.register("popover",r)}.call(this),function(){var e=this.crystal.Component,t=this.crystal.ComponentRegistry,n=this.crystal.SoyAop,r=this.crystal.SoyRenderer,i=this.crystal.SoyTemplates,s=i.get();"undefined"==typeof s.Treeview&&(s.Treeview={}),s.Treeview.content=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<div id="'+soy.$$escapeHtmlAttribute(e.id)+'" class="treeview component'+soy.$$escapeHtmlAttribute(e.elementClasses?" "+e.elementClasses:"")+'" role="tree">'+s.Treeview.nodes(e,null,n)+"</div>")},goog.DEBUG&&(s.Treeview.content.soyTemplateName="Templates.Treeview.content"),s.Treeview.nodes=function(e,t,n){var r="",i=e.id+"-"+(null!=e.surfaceId?e.surfaceId:"nodes");r+='<ul id="'+soy.$$escapeHtmlAttribute(i)+'" class="treeview-nodes">';for(var a=e.nodes,l=a.length,o=0;l>o;o++){var c=a[o],u=o;r+=s.Treeview.node({id:e.id,node:c,surfaceId:null!=e.parentSurfaceId?e.parentSurfaceId+"-"+u:u},null,n)}return r+="</ul>",soydata.VERY_UNSAFE.ordainSanitizedHtml(r)},goog.DEBUG&&(s.Treeview.nodes.soyTemplateName="Templates.Treeview.nodes"),s.Treeview.node=function(e,t,n){return soydata.VERY_UNSAFE.ordainSanitizedHtml('<li id="'+soy.$$escapeHtmlAttribute(e.id)+"-"+soy.$$escapeHtmlAttribute(e.surfaceId)+'" class="treeview-node">'+(e.node?'<div class="treeview-node-wrapper'+soy.$$escapeHtmlAttribute(e.node.expanded?" expanded":"")+'"><div class="treeview-node-main clearfix'+soy.$$escapeHtmlAttribute(e.node.children?" hasChildren":"")+'" data-onclick="handleNodeClicked_" data-onkeyup="handleNodeKeyUp_" aria-expanded="'+soy.$$escapeHtmlAttribute(e.node.expanded?"true":"false")+'" role="treeitem" tabindex="0">'+(e.node.children?'<div class="treeview-node-toggler"></div>':"")+'<span class="treeview-node-name">'+soy.$$escapeHtml(e.node.name)+"</span></div>"+(e.node.children?s.Treeview.nodes({id:e.id,nodes:e.node.children,parentSurfaceId:e.surfaceId,surfaceId:e.surfaceId+"-nodes"},null,n):"")+"</div>":"")+"</li>")},goog.DEBUG&&(s.Treeview.node.soyTemplateName="Templates.Treeview.node"),s.Treeview.content.params=["id"],s.Treeview.nodes.params=["id","nodes","parentSurfaceId","surfaceId"],s.Treeview.node["private"]=!0;var a=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,null,[{key:"setImpl",value:function(e){t.register(e,"Treeview")}}]),n}(e);a.RENDERER=r,a.setImpl(a),n.registerTemplates("Treeview"),this.crystal.Treeview=a}.call(this),function(){var e=this.crystal.dom,t=this.crystal.Treeview,n=function(t){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,t),babelHelpers.createClass(n,[{key:"attached",value:function(){this.on("nodesChanged",this.onNodesChanged_),this.on("renderSurface",this.handleRenderSurface_)}},{key:"getNodeObj",value:function(e){for(var t=this.nodes[e[0]],n=1;n<e.length;n++)t=t.children[e[n]];return t}},{key:"getNodeObjFromId_",value:function(e){var t=e.substr(this.id.length+1).split("-");return this.getNodeObj(t)}},{key:"handleNodeClicked_",value:function(e){this.toggleExpandedState_(e.delegateTarget)}},{key:"handleNodeKeyUp_",value:function(e){(13===e.keyCode||32===e.keyCode)&&this.toggleExpandedState_(e.delegateTarget)}},{key:"handleRenderSurface_",value:function(e,t){this.ignoreSurfaceUpdate_&&(t.preventDefault(),this.ignoreSurfaceUpdate_=!1)}},{key:"onNodesChanged_",value:function(){this.ignoreSurfaceUpdate_=!1}},{key:"toggleExpandedState_",value:function(t){var n=this.getNodeObjFromId_(t.parentNode.parentNode.id);n.expanded=!n.expanded,n.expanded?(e.addClasses(t.parentNode,"expanded"),t.setAttribute("aria-expanded","true")):(e.removeClasses(t.parentNode,"expanded"),t.setAttribute("aria-expanded","false")),this.nodes=this.nodes,this.ignoreSurfaceUpdate_=!0}}]),n}(t);n.ELEMENT_CLASSES="treeview",n.ATTRS={nodes:{validator:Array.isArray,valueFn:function(){return[]}}},t.setImpl(n),this.crystal.Treeview=n;var r=this.crystal.JQueryAdapter;r.register("treeview",n)}.call(this),function(){var e=this.crystal.core,t=this.crystal.dom,n=this.crystal.Attribute,r=this.crystal.EventEmitter,i=this.crystal.EventEmitterProxy,s=this.crystal.Position,a=function(n){function a(e){babelHelpers.classCallCheck(this,a);var t=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(a).call(this,e));return a.emitter_||(a.emitter_=new r,a.proxy_=new i(document,a.emitter_,null,{scroll:!0})),t.lastPosition_=null,t.scrollHandle_=a.emitter_.on("scroll",t.checkPosition.bind(t)),t.on("elementChanged",t.checkPosition),t.on("offsetTopChanged",t.checkPosition),t.on("offsetBottomChanged",t.checkPosition),t.checkPosition(),t}return babelHelpers.inherits(a,n),babelHelpers.createClass(a,[{key:"disposeInternal",value:function(){t.removeClasses(this.element,a.Position.Bottom+" "+a.Position.Default+" "+a.Position.Top),this.scrollHandle_.dispose(),babelHelpers.get(Object.getPrototypeOf(a.prototype),"disposeInternal",this).call(this)}},{key:"checkPosition",value:function(){this.intersectTopRegion()?this.syncPosition(a.Position.Top):this.intersectBottomRegion()?this.syncPosition(a.Position.Bottom):this.syncPosition(a.Position.Default)}},{key:"intersectBottomRegion",value:function(){if(!e.isDef(this.offsetBottom))return!1;var t=s.getHeight(this.scrollElement),n=s.getClientHeight(this.scrollElement);return s.getScrollTop(this.scrollElement)+n>=t-this.offsetBottom}},{key:"intersectTopRegion",value:function(){return e.isDef(this.offsetTop)?s.getScrollTop(this.scrollElement)<=this.offsetTop:!1}},{key:"syncPosition",value:function(e){this.lastPosition_!==e&&(t.addClasses(this.element,e),t.removeClasses(this.element,this.lastPosition_),this.lastPosition_=e)}}]),a}(n);a.Position={Top:"affix-top",Bottom:"affix-bottom",Default:"affix-default"},a.ATTRS={scrollElement:{setter:t.toElement,value:document},offsetTop:{validator:e.isNumber},offsetBottom:{validator:e.isNumber},element:{setter:t.toElement}},this.crystal.Affix=a;var l=this.crystal.JQueryAdapter;l.register("affix",a)}.call(this);